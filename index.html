<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AVG Telehealth Partner Tracker</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f172a; color: #e2e8f0; min-height: 100vh; }
.header { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-bottom: 1px solid #334155; padding: 20px 32px; display: flex; justify-content: space-between; align-items: center; }
.header h1 { font-size: 22px; font-weight: 700; }
.header h1 span { color: #38bdf8; }
.header-actions { display: flex; gap: 10px; }
.btn { padding: 8px 18px; border-radius: 8px; border: none; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.2s; }
.btn-primary { background: #2563eb; color: white; }
.btn-primary:hover { background: #1d4ed8; }
.btn-success { background: #059669; color: white; }
.btn-success:hover { background: #047857; }
.btn-outline { background: transparent; border: 1px solid #475569; color: #94a3b8; }
.btn-outline:hover { border-color: #38bdf8; color: #38bdf8; }

.criteria-bar { background: #1e293b; border-bottom: 1px solid #334155; padding: 16px 32px; display: flex; gap: 16px; flex-wrap: wrap; align-items: center; }
.criteria-chip { background: #334155; padding: 6px 14px; border-radius: 20px; font-size: 12px; display: flex; align-items: center; gap: 6px; }
.criteria-chip .num { background: #2563eb; color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; }

.stats-bar { padding: 16px 32px; display: flex; gap: 16px; }
.stat-card { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 14px 20px; flex: 1; }
.stat-card .label { font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; }
.stat-card .value { font-size: 28px; font-weight: 700; margin-top: 4px; }
.stat-card .value.blue { color: #38bdf8; }
.stat-card .value.green { color: #34d399; }
.stat-card .value.amber { color: #fbbf24; }
.stat-card .value.red { color: #f87171; }

.filters { padding: 12px 32px; display: flex; gap: 10px; align-items: center; }
.filter-btn { padding: 6px 14px; border-radius: 6px; background: #1e293b; border: 1px solid #334155; color: #94a3b8; cursor: pointer; font-size: 12px; }
.filter-btn.active { background: #2563eb; border-color: #2563eb; color: white; }

.table-wrap { padding: 0 32px 32px; overflow-x: auto; }
table { width: 100%; border-collapse: collapse; font-size: 13px; }
thead th { background: #1e293b; padding: 10px 12px; text-align: left; font-weight: 600; color: #94a3b8; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; position: sticky; top: 0; border-bottom: 2px solid #334155; white-space: nowrap; }
tbody tr { border-bottom: 1px solid #1e293b; transition: background 0.15s; }
tbody tr:hover { background: #1e293b; }
tbody td { padding: 10px 12px; vertical-align: middle; }
.company-name { font-weight: 600; color: #f1f5f9; }
.company-url { font-size: 11px; color: #64748b; }
.company-url a { color: #38bdf8; text-decoration: none; }

.score-cell { text-align: center; }
.score-badge { display: inline-block; width: 28px; height: 28px; border-radius: 6px; line-height: 28px; text-align: center; font-weight: 700; font-size: 12px; }
.score-1 { background: #7f1d1d; color: #fca5a5; }
.score-2 { background: #78350f; color: #fcd34d; }
.score-3 { background: #713f12; color: #fde68a; }
.score-4 { background: #14532d; color: #86efac; }
.score-5 { background: #064e3b; color: #6ee7b7; }

.total-score { font-weight: 700; font-size: 16px; text-align: center; }
.total-high { color: #34d399; }
.total-mid { color: #fbbf24; }
.total-low { color: #f87171; }

.status-badge { padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; white-space: nowrap; }
.status-none { background: #374151; color: #9ca3af; }
.status-contacted { background: #1e3a5f; color: #60a5fa; }
.status-booked { background: #064e3b; color: #34d399; }
.status-done { background: #312e81; color: #a5b4fc; }
.status-rejected { background: #7f1d1d; color: #fca5a5; }

.editable { cursor: pointer; border-bottom: 1px dashed #475569; padding: 2px 4px; border-radius: 3px; min-width: 40px; display: inline-block; }
.editable:hover { background: #334155; }
.editable:focus { outline: 2px solid #2563eb; background: #1e293b; }

select.inline-select { background: #1e293b; border: 1px solid #475569; color: #e2e8f0; padding: 4px 8px; border-radius: 6px; font-size: 12px; cursor: pointer; }

.decision-go { color: #34d399; font-weight: 700; }
.decision-nogo { color: #f87171; font-weight: 700; }
.decision-pending { color: #94a3b8; }

.notes-cell { max-width: 200px; }
.notes-cell .editable { font-size: 11px; color: #94a3b8; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px; }

.modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 100; justify-content: center; align-items: center; }
.modal-overlay.show { display: flex; }
.modal { background: #1e293b; border: 1px solid #334155; border-radius: 16px; padding: 28px; width: 600px; max-width: 90vw; max-height: 80vh; overflow-y: auto; }
.modal h2 { font-size: 18px; margin-bottom: 20px; }
.modal label { display: block; font-size: 12px; color: #94a3b8; margin-bottom: 4px; margin-top: 12px; }
.modal input, .modal textarea, .modal select { width: 100%; background: #0f172a; border: 1px solid #475569; color: #e2e8f0; padding: 8px 12px; border-radius: 8px; font-size: 13px; }
.modal textarea { min-height: 80px; resize: vertical; }
.modal-actions { margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end; }

.score-input-group { display: flex; gap: 8px; margin-top: 12px; }
.score-input-item { flex: 1; text-align: center; }
.score-input-item label { font-size: 10px; }
.score-input-item select { text-align: center; }

.meeting-section { margin-top: 16px; padding-top: 16px; border-top: 1px solid #334155; }
.meeting-section h3 { font-size: 14px; color: #38bdf8; margin-bottom: 8px; }

.row-actions { display: flex; gap: 4px; }
.row-btn { background: none; border: none; cursor: pointer; padding: 4px; border-radius: 4px; color: #64748b; font-size: 14px; }
.row-btn:hover { background: #334155; color: #e2e8f0; }

.meeting-done-badge { display: inline-flex; align-items: center; gap: 4px; background: #312e81; color: #a5b4fc; padding: 3px 8px; border-radius: 6px; font-size: 10px; font-weight: 700; }
.meeting-done-badge .check { color: #34d399; font-size: 14px; }

.summary-toggle { cursor: pointer; color: #38bdf8; font-size: 11px; text-decoration: underline; margin-top: 4px; display: inline-block; }
.summary-toggle:hover { color: #7dd3fc; }

.summary-panel { display: none; background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 12px; margin-top: 8px; font-size: 11px; color: #cbd5e1; line-height: 1.5; max-height: 300px; overflow-y: auto; }
.summary-panel.show { display: block; }
.summary-panel h4 { color: #38bdf8; font-size: 12px; margin: 8px 0 4px; }
.summary-panel h4:first-child { margin-top: 0; }
.summary-panel ul { margin: 4px 0 4px 16px; }
.summary-panel .verdict { padding: 8px; border-radius: 6px; margin-top: 8px; font-weight: 600; }
.summary-panel .verdict-positive { background: #064e3b; color: #34d399; border: 1px solid #059669; }
.summary-panel .verdict-neutral { background: #78350f; color: #fcd34d; border: 1px solid #d97706; }
.summary-panel .verdict-negative { background: #7f1d1d; color: #fca5a5; border: 1px solid #dc2626; }
</style>
</head>
<body>

<div class="header">
  <h1>AVG <span>Telehealth Partner Tracker</span></h1>
  <div class="header-actions">
    <button class="btn btn-outline" onclick="addCompany()">+ –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é</button>
    <button class="btn btn-success" onclick="saveFile()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª</button>
  </div>
</div>

<div class="criteria-bar">
  <span style="font-size:12px;color:#64748b;margin-right:4px;">–ö—Ä–∏—Ç–µ—Ä–∏–∏ (1-5):</span>
  <div class="criteria-chip"><span class="num">1</span> –ü–æ—Å—Ç–∞–≤–∫–∞ –≤—Ä–∞—á–µ–π</div>
  <div class="criteria-chip"><span class="num">2</span> 50 —à—Ç–∞—Ç–æ–≤</div>
  <div class="criteria-chip"><span class="num">3</span> White-label + BYO pharmacy</div>
  <div class="criteria-chip"><span class="num">4</span> TRT/HRT/–ø–µ–ø—Ç–∏–¥—ã/WL</div>
  <div class="criteria-chip"><span class="num">5</span> –¶–µ–Ω–æ–≤–∞—è –º–æ–¥–µ–ª—å</div>
  <span style="font-size:11px;color:#475569;margin-left:8px;">–ü—Ä–æ—Ö–æ–¥–Ω–æ–π –±–∞–ª–ª: ‚â•18/25</span>
</div>

<div class="stats-bar" id="stats-bar"></div>

<div class="filters">
  <span style="font-size:12px;color:#64748b;">–§–∏–ª—å—Ç—Ä:</span>
  <button class="filter-btn active" onclick="setFilter('all')">–í—Å–µ</button>
  <button class="filter-btn" onclick="setFilter('qualified')">–ö–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</button>
  <button class="filter-btn" onclick="setFilter('booked')">–í—Å—Ç—Ä–µ—á–∞ –∑–∞–±—É–∫–∞–Ω–∞</button>
  <button class="filter-btn" onclick="setFilter('done')">–í—Å—Ç—Ä–µ—á–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∞</button>
</div>

<div class="table-wrap">
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>–ö–æ–º–ø–∞–Ω–∏—è</th>
        <th class="score-cell">–í—Ä–∞—á–∏</th>
        <th class="score-cell">50 —à—Ç.</th>
        <th class="score-cell">WL+Pharm</th>
        <th class="score-cell">–†–µ–ª–µ–≤.</th>
        <th class="score-cell">–¶–µ–Ω–∞</th>
        <th class="score-cell">–ò—Ç–æ–≥–æ</th>
        <th>–°—Ç–∞—Ç—É—Å</th>
        <th>–í—Å—Ç—Ä–µ—á–∞ / Zoom</th>
        <th>–¶–µ–Ω–∞/–≤–∏–∑–∏—Ç</th>
        <th>–ó–∞–ø—É—Å–∫</th>
        <th>–†–µ—à–µ–Ω–∏–µ</th>
        <th>–ó–∞–º–µ—Ç–∫–∏</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="table-body"></tbody>
  </table>
</div>

<!-- Edit Modal -->
<div class="modal-overlay" id="edit-modal">
  <div class="modal">
    <h2 id="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é</h2>
    <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
    <input id="m-name" placeholder="Company Name">
    <label>–°–∞–π—Ç</label>
    <input id="m-url" placeholder="https://...">
    <label>–ö–æ–Ω—Ç–∞–∫—Ç (URL/email –¥–ª—è –±—É–∫–∏–Ω–≥–∞)</label>
    <input id="m-contact" placeholder="https://... –∏–ª–∏ email">

    <div class="score-input-group">
      <div class="score-input-item"><label>–í—Ä–∞—á–∏</label><select id="m-s1"><option>1</option><option>2</option><option>3</option><option selected>4</option><option>5</option></select></div>
      <div class="score-input-item"><label>50 —à—Ç.</label><select id="m-s2"><option>1</option><option>2</option><option>3</option><option selected>4</option><option>5</option></select></div>
      <div class="score-input-item"><label>WL+Pharm</label><select id="m-s3"><option>1</option><option>2</option><option>3</option><option selected>4</option><option>5</option></select></div>
      <div class="score-input-item"><label>–†–µ–ª–µ–≤.</label><select id="m-s4"><option>1</option><option>2</option><option>3</option><option selected>4</option><option>5</option></select></div>
      <div class="score-input-item"><label>–¶–µ–Ω–∞</label><select id="m-s5"><option>1</option><option>2</option><option>3</option><option selected>4</option><option>5</option></select></div>
    </div>

    <label>–°—Ç–∞—Ç—É—Å</label>
    <select id="m-status">
      <option value="none">–ù–µ –Ω–∞—á–∞—Ç</option>
      <option value="contacted">–§–æ—Ä–º–∞/Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω</option>
      <option value="booked">–í—Å—Ç—Ä–µ—á–∞ –∑–∞–±—É–∫–∞–Ω–∞</option>
      <option value="done">–í—Å—Ç—Ä–µ—á–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∞</option>
      <option value="rejected">–ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç</option>
    </select>

    <div class="meeting-section">
      <h3>–ü–æ—Å–ª–µ –≤—Å—Ç—Ä–µ—á–∏</h3>
      <label>–î–∞—Ç–∞/–≤—Ä–µ–º—è –≤—Å—Ç—Ä–µ—á–∏</label>
      <input id="m-meeting-date" placeholder="Feb 27, 10:00 AM ET">
      <label>–°—Å—ã–ª–∫–∞ –Ω–∞ Zoom/Meet</label>
      <input id="m-meeting-link" placeholder="https://zoom.us/j/... –∏–ª–∏ https://meet.google.com/...">
      <label>–¶–µ–Ω–∞ –∑–∞ –≤–∏–∑–∏—Ç / –º–æ–¥–µ–ª—å</label>
      <input id="m-price" placeholder="$75/consult, $X/month, rev-share...">
      <label>–°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞</label>
      <input id="m-launch" placeholder="2-4 weeks, 30 days, etc.">
      <label>–†–µ—à–µ–Ω–∏–µ</label>
      <select id="m-decision">
        <option value="pending">–û–∂–∏–¥–∞–Ω–∏–µ</option>
        <option value="go">GO ‚úì</option>
        <option value="nogo">NO-GO ‚úó</option>
      </select>
      <label>–ó–∞–º–µ—Ç–∫–∏</label>
      <textarea id="m-notes" placeholder="–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã, –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è, –∫–æ–Ω—Ç–∞–∫—Ç—ã..."></textarea>
    </div>

    <div class="modal-actions">
      <button class="btn btn-outline" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn btn-primary" onclick="saveModal()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<script>
// ========== FIREBASE CONFIG ==========
firebase.initializeApp({
  apiKey: "AIzaSyAvNGtUi6xoV_cMozgsDfJ9qfhOPvRe7N0",
  authDomain: "adv-meetings.firebaseapp.com",
  projectId: "adv-meetings",
  storageBucket: "adv-meetings.firebasestorage.app",
  messagingSenderId: "1044887682497",
  appId: "1:1044887682497:web:cc7944ddd314ea79144340"
});
var db = firebase.firestore();
var COLLECTION = 'companies';

// ========== DATA (fallback seed ‚Äî used only if Firestore is empty) ==========
var SEED_DATA = [
  // ===== –ó–ê–ë–£–ö–ê–ù–ù–´–ï –í–°–¢–†–ï–ß–ò (–ø–æ –¥–∞—Ç–µ) =====
  {
    id: 7, name: "DrCare247", url: "https://drcare247.com", contact: "https://www.drcare247.com/",
    scores: {s1:4, s2:5, s3:3, s4:2, s5:2},
    status: "done", meetingDate: "Feb 26, 1:30 PM ET (—á—Ç)", price: "$5000 setup + $500/–º–µ—Å + $1000/–º–µ—Å –º–∏–Ω (20 –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π) + $50/–∫–æ–Ω—Å—É–ª—å—Ç —Å–≤–µ—Ä—Ö", launch: "2-4 –Ω–µ–¥–µ–ª–∏ –ø–æ—Å–ª–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞", decision: "pending",
    meetingLink: "https://us06web.zoom.us/j/89130178538?pwd=lxfiPffWmRPxGM1POOGN5iYkPBj6E.1",
    notes: "‚úÖ –í–°–¢–†–ï–ß–ê –ü–†–û–í–ï–î–ï–ù–ê 26 —Ñ–µ–≤. –ö–æ–Ω—Ç–∞–∫—Ç: Shafi Ahamed, —Ç–µ–ª: +917708614041 / US: +1 6302306699. –†–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ WebDoctors (webdoctors.com/meet-the-doctor) ‚Äî 6 –≤—Ä–∞—á–µ–π, board-certified MDs, –≤—Å–µ 50 —à—Ç–∞—Ç–æ–≤, Chicago-based –¥–æ 10 PM CT. –ê–ø—Ç–µ–∫–∞: Belmar Pharma Solutions (belmarpharmasolutions.com), –º–æ–≥—É—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å Empower. Turnkey: intake ‚Üí eligibility ‚Üí –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è (video/phone, 15-30 –º–∏–Ω callback) ‚Üí Rx ‚Üí shipping 24-48—á. SSO + patient portal + Shopify –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è + GoHighLevel CRM + PracticeQ. –ü—Ä–æ—Ç–æ–∫–æ–ª—ã TRT/GLP/ED —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏–ª–∏ —Å–≤–æ–∏. HIPAA, BAA, MSO –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã. –¶–µ–Ω–∞: $5K setup, $500/–º–µ—Å tech, $1000/–º–µ—Å –º–∏–Ω –∑–∞ 20 –∫–æ–Ω—Å—É–ª—å—Ç–æ–≤, –¥–∞–ª–µ–µ $50/–∫–æ–Ω—Å—É–ª—å—Ç. –ú–∏–Ω—É—Å—ã: –Ω–µ—Ç —Ç–æ—á–Ω–æ–≥–æ —Å–ª–æ—Ç–æ–≤–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (—Ç–æ–ª—å–∫–æ callback 15-30 –º–∏–Ω), –ø–µ–ø—Ç–∏–¥—ã ‚Äî –Ω–µ –≤–æ –≤—Å–µ—Ö —à—Ç–∞—Ç–∞—Ö. –°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì: –ø–æ–ª—É—á–∏—Ç—å proposal —Å —Ü–µ–Ω–∞–º–∏ –æ—Ç Shafi, –Ω–∞–∑–Ω–∞—á–∏—Ç—å follow-up –∑–≤–æ–Ω–æ–∫.",
    meetingSummary: {
      verdict: "positive",
      verdictText: "–•–æ—Ä–æ—à–∏–π –∫–∞–Ω–¥–∏–¥–∞—Ç ‚Äî –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ 50 —à—Ç–∞—Ç–æ–≤, turnkey —Ä–µ—à–µ–Ω–∏–µ, —Ä–∞–∑—É–º–Ω–∞—è —Ü–µ–Ω–∞. –ù—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å —Å–ª–æ—Ç—ã –∏ –ø–µ–ø—Ç–∏–¥—ã.",
      pricing: "$5000 setup + $500/–º–µ—Å tech + $1000/–º–µ—Å –º–∏–Ω–∏–º—É–º (20 –∫–æ–Ω—Å—É–ª—å—Ç–æ–≤) + $50/–∫–æ–Ω—Å—É–ª—å—Ç –¥–∞–ª–µ–µ",
      nextSteps: "–ü–æ–ª—É—á–∏—Ç—å proposal, –Ω–∞–∑–Ω–∞—á–∏—Ç—å follow-up –∑–≤–æ–Ω–æ–∫ —Å Shafi (+1 6302306699)",
      keyContacts: "Shafi Ahamed: +917708614041 / US: +1 6302306699",
      partners: "WebDoctors (webdoctors.com), Belmar Pharma (belmarpharmasolutions.com)"
    }
  },
  {
    id: 8, name: "Qualiphy", url: "https://qualiphy.me", contact: "lorena@qualiphy.me",
    scores: {s1:2, s2:4, s3:2, s4:3, s5:2},
    status: "booked", meetingDate: "Feb 27, 10:00 AM ET (–ø—Ç)", price: "$27.99/–≤–∏–∑–∏—Ç", launch: "", decision: "pending",
    meetingLink: "https://meet.google.com/xmq-ztmu-ysa",
    notes: "–í—Å—Ç—Ä–µ—á–∞ –ø—Ç 27 —Ñ–µ–≤ 10:00-10:30 AM ET. 'Qualiphy GFE & Rx Fulfillment Solution' —Å Lorena Santiago (lorena@qualiphy.me). Google Meet: meet.google.com/xmq-ztmu-ysa. Calendly: calendly.com/events/a4cf7a11-31af-48dc-a5b9-2e555654b21e/google_meet. Pay-per-consult –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å ($27.99/–≤–∏–∑–∏—Ç). –£—Ç–æ—á–Ω–∏—Ç—å –º–æ–¥–µ–ª—å."
  },
  {
    id: 13, name: "Bask Health", url: "https://bask.health", contact: "https://bask.health/",
    scores: {s1:3, s2:3, s3:4, s4:3, s5:3},
    status: "booked", meetingDate: "Feb 27, 11:30 AM ET (–ø—Ç)", price: "", launch: "", decision: "pending",
    meetingLink: "https://meet.google.com/ohw-zxmi-sqa",
    notes: "Intro & Demo –ø—Ç 27 —Ñ–µ–≤ 11:30 AM —Å Susanna Lewis. Google Meet: meet.google.com/ohw-zxmi-sqa. –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ Private Beta. –°–æ—Ñ—Ç: EMR, Compounding, Pharmacy, Order Mgmt. –£—Ç–æ—á–Ω–∏—Ç—å: –ø–æ—Å—Ç–∞–≤–ª—è—é—Ç –ª–∏ –≤—Ä–∞—á–µ–π –∏–ª–∏ —Ç–æ–ª—å–∫–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É."
  },
  {
    id: 12, name: "White Label Rx", url: "https://whitelblrx.com", contact: "https://whitelblrx.com/",
    scores: {s1:5, s2:5, s3:4, s4:5, s5:3},
    status: "booked", meetingDate: "Feb 27, 1:30 PM ET (–ø—Ç)", price: "", launch: "", decision: "pending",
    meetingLink: "https://us06web.zoom.us/j/84051750039?pwd=aJBtBjiZ9cMfXfzxDLOw4bajCZ880s.1",
    notes: "‚≠ê GREAT FIT 22/25! –ü—Ç 27 —Ñ–µ–≤ 1:30 PM. Zoom —Å Richard K√∂hn (smartdoctors.us), pwd: 216710. –í—Ä–∞—á–∏ 50 —à—Ç–∞—Ç–æ–≤ + Puerto Rico. ED, Weight Loss, OTC. Pharmacy integration. White-label, HIPAA. –ü–†–ò–û–†–ò–¢–ï–¢ #2!"
  },
  {
    id: 10, name: "Beluga Health", url: "https://belugahealth.com", contact: "https://www.belugahealth.com/",
    scores: {s1:5, s2:5, s3:4, s4:3, s5:3},
    status: "booked", meetingDate: "Mar 1, 9:20 AM ET (–≤—Å)", price: "", launch: "", decision: "pending",
    meetingLink: "https://meet.google.com/yng-dbvd-ctw",
    notes: "‚≠ê GOOD FIT 20/25. –í—Å 1 –º–∞—Ä—Ç–∞ 9:20-9:40 AM ET, Google Meet, Discovery Call —Å Joshua Kishineff (joshua@belugahealth.com). Physician-only network, all 50 states. True white-label, DTC-native. –ü–µ—Ä–µ–Ω–æ—Å: https://beluga-health.cal.com/booking/sDSH2apioFB89Nn1TMvoDH"
  },
  {
    id: 6, name: "Ola Digital Health", url: "https://oladigital.health", contact: "https://scheduler.zoom.us/alpeshrph/ola-digital-health-",
    scores: {s1:4, s2:5, s3:4, s4:4, s5:3},
    status: "booked", meetingDate: "Mar 2, 2:45 PM ET (–ø–Ω)", price: "", launch: "", decision: "pending",
    meetingLink: "https://us02web.zoom.us/j/7572757275?omn=85426982367",
    notes: "–ü–Ω 2 –º–∞—Ä—Ç–∞ 14:45-15:30 ET, Zoom —Å Alpesh Patel (therxcare@gmail.com). –£—á–∞—Å—Ç–Ω–∏–∫–∏: het, dhwani, sakshi, alpesh @oladigital.health. –°–µ—Ç—å –≤—Ä–∞—á–µ–π –≤–æ –≤—Å–µ—Ö 50 —à—Ç–∞—Ç–∞—Ö."
  },
  {
    id: 15, name: "White Label MD", url: "https://whitelabelmd.com", contact: "https://launch.whitelabelmd.com/",
    scores: {s1:4, s2:4, s3:4, s4:3, s5:3},
    status: "booked", meetingDate: "Mar 4, 2:00 PM ET (—Å—Ä)", price: "", launch: "", decision: "pending",
    meetingLink: "https://meet.google.com/kkn-ghnv-mqn",
    notes: "‚≠ê 18/25. –í–°–¢–†–ï–ß–ê –ó–ê–ë–£–ö–ê–ù–ê —Å—Ä 4 –º–∞—Ä—Ç–∞ 2:00 PM ET —Å Justin Champion (justin.champion@whitelabelmd.com). Google Meet: meet.google.com/kkn-ghnv-mqn. Justin –ü–†–ò–ù–Ø–õ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ. 'We can help' ‚Äî –æ—Ç–≤–µ—Ç–∏–ª –º–≥–Ω–æ–≤–µ–Ω–Ω–æ. 100+ founders –∑–∞–ø—É—Å—Ç–∏–ª–∏—Å—å –∑–∞ 6 –º–µ—Å. E-commerce telemedicine + on-demand Rx fulfillment. Turnkey white-label."
  },
  // ===== CONTACTED (–ø–æ –±–∞–ª–ª–∞–º ‚Äî –≤—ã—Å—à–∏–µ –ø–µ—Ä–≤—ã–µ) =====
  {
    id: 2, name: "OpenLoop Health", url: "https://openloophealth.com", contact: "https://openloophealth.com/contact-sales",
    scores: {s1:5, s2:5, s3:5, s4:5, s5:3},
    status: "booked", meetingDate: "Mar 2, 3:30 PM ET (–ø–Ω)", price: "", launch: "", decision: "pending",
    meetingLink: "https://meet.google.com/ugz-zbvu-rss",
    notes: "‚≠ê TOP FIT 23/25! –í–°–¢–†–ï–ß–ê –ó–ê–ë–£–ö–ê–ù–ê –ø–Ω 2 –º–∞—Ä—Ç–∞ 3:30-4:00 PM EST. Google Meet: meet.google.com/ugz-zbvu-rss. –ö–æ–Ω—Ç–∞–∫—Ç: Jordan Narlock (jordan.narlock@openloophealth.com) + Emma Evans (emma.evans@openloophealth.com, Sales Dev Rep). ‚ö†Ô∏è –°—Ä–∞–∑—É –ø–æ—Å–ª–µ Ola Digital Health (2:45-3:30 PM) ‚Äî –ø–ª–æ—Ç–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ! 20k –∫–ª–∏–Ω–∏—Ü–∏—Å—Ç–æ–≤. –í—Å–µ 50 —à—Ç–∞—Ç–æ–≤. Weight loss, longevity, sexual health. Full white-label. 'Full-stack, white-labeled solutions'."
  },
  {
    id: 9, name: "MD Integrations", url: "https://mdintegrations.com", contact: "https://mdintegrations.com/faq",
    scores: {s1:5, s2:5, s3:4, s4:5, s5:4},
    status: "booked", meetingDate: "Mar 3, 2:00 PM ET (–≤—Ç)", price: "", launch: "", decision: "pending",
    meetingLink: "https://mdintegrations.zoom.us/j/89683357553?pwd=qBQ0s8erdNrSMvdaKZaENkRkOfBQ4H.1",
    notes: "‚≠ê PERFECT FIT 23/25! –ü–†–ò–û–†–ò–¢–ï–¢ #1! –í–°–¢–†–ï–ß–ê –ó–ê–ë–£–ö–ê–ù–ê –≤—Ç 3 –º–∞—Ä—Ç–∞ 2:00 PM EST. Zoom: mdintegrations.zoom.us/j/89683357553, Meeting ID: 896 8335 7553, Passcode: 167Mff. –ö–æ–Ω—Ç–∞–∫—Ç: Alyssa Foxson, MS (a.fox@mdintegrations.com, Inside Sales). Doctor-founded, 50 states, API-first. –ï—ë –∫–∞–ª–µ–Ω–¥–∞—Ä—å: calendar.app.google/k4wQiF3TBEu7dFBK6."
  },
  {
    id: 1, name: "SteadyMD", url: "https://steadymd.com", contact: "https://www.steadymd.com/contact/",
    scores: {s1:5, s2:5, s3:4, s4:5, s5:3},
    status: "contacted", meetingDate: "", price: "", launch: "", decision: "pending",
    meetingLink: "",
    notes: "‚≠ê –û–¢–í–ï–¢ –æ—Ç Lindsey Anderson (VP Enterprise Sales, lindsey@steadymd.com) 26 —Ñ–µ–≤. –ü—Ä–æ—Å–∏—Ç –¥–µ—Ç–∞–ª–∏: –∫–∞–∫–∏–µ –º–µ–¥. –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –º–∞—Å—à—Ç–∞–±, —Ç–µ–∫—É—â–∏–µ/–Ω–æ–≤—ã–µ –ø–∞—Ü–∏–µ–Ω—Ç—ã. –ù–£–ñ–ù–û –û–¢–í–ï–¢–ò–¢–¨ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º TRT/HRT –ø—Ä–æ–≥—Ä–∞–º–º—ã. –°–æ—Ç–Ω–∏ –≤—Ä–∞—á–µ–π –≤–æ –≤—Å–µ—Ö 50 —à—Ç–∞—Ç–∞—Ö. –ü–∞—Ä—Ç–Ω—ë—Ä—ã Amazon Clinic."
  },
  {
    id: 4, name: "WellSync", url: "https://wellsync.com", contact: "https://wellsync.com/contact/",
    scores: {s1:4, s2:3, s3:4, s4:5, s5:3},
    status: "contacted", meetingDate: "", price: "", launch: "", decision: "pending",
    meetingLink: "",
    notes: "–§–æ—Ä–º–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞, –∂–¥—ë—Ç reCAPTCHA. Telehealth Provider Network. TRT, GLP-1, –ø–µ–ø—Ç–∏–¥—ã –≤ —á–µ–∫–±–æ–∫—Å–∞—Ö —Ñ–æ—Ä–º—ã. –ü–æ–∫—Ä—ã—Ç–∏–µ —à—Ç–∞—Ç–æ–≤ —É—Ç–æ—á–Ω–∏—Ç—å."
  },
  {
    id: 5, name: "MyTelemedicine", url: "https://mytelemedicine.com", contact: "sales@mytelemedicine.com",
    scores: {s1:4, s2:4, s3:4, s4:4, s5:3},
    status: "contacted", meetingDate: "", price: "", launch: "", decision: "pending",
    meetingLink: "",
    notes: "Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ sales@mytelemedicine.com. JD Power #1 2024. Nationwide clinician network. White-label, DTC-focused."
  },
  {
    id: 3, name: "Wheel", url: "https://wheel.com", contact: "https://info.wheel.com/l/1037703/2026-01-30/37bh9",
    scores: {s1:4, s2:5, s3:2, s4:3, s5:2},
    status: "contacted", meetingDate: "", price: "", launch: "", decision: "pending",
    meetingLink: "",
    notes: "‚ö†Ô∏è MAYBE ‚Äî —Ñ–æ—Ä–º–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞, –∂–¥—ë—Ç reCAPTCHA. $216M funding. –ù–µ —è—Å–Ω–æ: BYO-pharmacy (2/5), –Ω–µ—Ç —è–≤–Ω–æ–≥–æ —Ñ–æ–∫—É—Å–∞ TRT/–ø–µ–ø—Ç–∏–¥—ã (3/5), enterprise-pricing –Ω–µ –¥–ª—è $137/–º–µ—Å (2/5). –£—Ç–æ—á–Ω–∏—Ç—å –Ω–∞ –∑–≤–æ–Ω–∫–µ."
  },
  {
    id: 16, name: "This American Doc", url: "https://thisamericandoc.com", contact: "https://thisamericandoc.com/companies",
    scores: {s1:4, s2:4, s3:3, s4:2, s5:3},
    status: "rejected", meetingDate: "", price: "", launch: "", decision: "nogo",
    meetingLink: "",
    notes: "‚ùå –ë–ê–£–ù–° ‚Äî email info@thisamericandoc.com –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (550 5.1.1 address not found). Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω 26 —Ñ–µ–≤, –≤–µ—Ä–Ω—É–ª—Å—è. Physician-owned telehealth staffing. 16/25 ‚Äî –±—ã–ª –Ω–∏–∂–µ –ø—Ä–æ—Ö–æ–¥–Ω–æ–≥–æ. –£–ë–†–ê–¢–¨."
  }
];

var DATA = [];
var currentFilter = 'all';
var editingId = null;
var syncStatus = 'idle'; // idle, syncing, synced, error

// ========== FIRESTORE FUNCTIONS ==========
function setSyncStatus(status, msg) {
  syncStatus = status;
  var el = document.getElementById('sync-indicator');
  if (!el) return;
  var labels = {idle:'', syncing:'‚è≥ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...', synced:'‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –æ–±–ª–∞–∫–æ', error:'‚ùå –û—à–∏–±–∫–∞: ' + (msg||'')};
  var colors = {idle:'transparent', syncing:'#fbbf24', synced:'#34d399', error:'#f87171'};
  el.textContent = labels[status] || '';
  el.style.color = colors[status] || '#94a3b8';
  if (status === 'synced') setTimeout(function(){ if (syncStatus === 'synced') { el.textContent = ''; } }, 3000);
}

async function loadFromFirestore() {
  try {
    var snapshot = await db.collection(COLLECTION).get();
    if (snapshot.empty) return [];
    var arr = [];
    snapshot.forEach(function(doc) {
      var d = doc.data();
      d._docId = doc.id;
      arr.push(d);
    });
    return arr;
  } catch(e) {
    console.error('Firestore load error:', e);
    return [];
  }
}

async function saveToFirestore(obj) {
  setSyncStatus('syncing');
  try {
    var docId = String(obj.id);
    var saveObj = Object.assign({}, obj);
    delete saveObj._docId;
    await db.collection(COLLECTION).doc(docId).set(saveObj);
    setSyncStatus('synced');
  } catch(e) {
    console.error('Firestore save error:', e);
    setSyncStatus('error', e.message);
  }
}

async function deleteFromFirestore(id) {
  setSyncStatus('syncing');
  try {
    await db.collection(COLLECTION).doc(String(id)).delete();
    setSyncStatus('synced');
  } catch(e) {
    console.error('Firestore delete error:', e);
    setSyncStatus('error', e.message);
  }
}

async function seedFirestore() {
  setSyncStatus('syncing');
  try {
    var batch = db.batch();
    SEED_DATA.forEach(function(item) {
      var docRef = db.collection(COLLECTION).doc(String(item.id));
      batch.set(docRef, item);
    });
    await batch.commit();
    setSyncStatus('synced');
    console.log('Seeded ' + SEED_DATA.length + ' companies to Firestore');
  } catch(e) {
    console.error('Firestore seed error:', e);
    setSyncStatus('error', e.message);
  }
}

async function initApp() {
  // Add sync indicator to header
  var headerActions = document.querySelector('.header-actions');
  if (headerActions) {
    var indicator = document.createElement('span');
    indicator.id = 'sync-indicator';
    indicator.style.cssText = 'font-size:12px;padding:8px 12px;color:#94a3b8;';
    headerActions.insertBefore(indicator, headerActions.firstChild);
  }

  setSyncStatus('syncing');
  var firestoreData = await loadFromFirestore();

  if (firestoreData.length > 0) {
    DATA = firestoreData;
    console.log('Loaded ' + DATA.length + ' companies from Firestore');
    setSyncStatus('synced');
  } else {
    console.log('Firestore empty ‚Äî seeding with SEED_DATA...');
    DATA = SEED_DATA.slice();
    await seedFirestore();
  }
  renderAll();
}

// ========== UI FUNCTIONS ==========
function getTotal(c) { return c.scores.s1 + c.scores.s2 + c.scores.s3 + c.scores.s4 + c.scores.s5; }
function isQualified(c) { return getTotal(c) >= 18; }

function renderStats() {
  var total = DATA.length;
  var qualified = DATA.filter(isQualified).length;
  var booked = DATA.filter(c => c.status === 'booked' || c.status === 'done').length;
  var done = DATA.filter(c => c.status === 'done').length;
  document.getElementById('stats-bar').innerHTML = `
    <div class="stat-card"><div class="label">–í—Å–µ–≥–æ –∫–æ–º–ø–∞–Ω–∏–π</div><div class="value blue">${total}</div></div>
    <div class="stat-card"><div class="label">–ö–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö (‚â•18)</div><div class="value green">${qualified}</div></div>
    <div class="stat-card"><div class="label">–í—Å—Ç—Ä–µ—á –∑–∞–±—É–∫–∞–Ω–æ</div><div class="value amber">${booked}</div></div>
    <div class="stat-card"><div class="label">–í—Å—Ç—Ä–µ—á –ø—Ä–æ–≤–µ–¥–µ–Ω–æ</div><div class="value red">${done}</div></div>
  `;
}

function parseMeetingDate(str) {
  if (!str) return null;
  // Format: "Feb 27, 1:30 PM ET (–ø—Ç)" or "Mar 2, 3:30 PM ET (–ø–Ω)"
  var m = str.match(/^(\w+)\s+(\d+),?\s+(\d+):(\d+)\s+(AM|PM)/i);
  if (!m) return null;
  var months = {Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};
  var mon = months[m[1]];
  if (mon === undefined) return null;
  var day = parseInt(m[2]);
  var hour = parseInt(m[3]);
  var min = parseInt(m[4]);
  if (m[5] === 'PM' && hour < 12) hour += 12;
  if (m[5] === 'AM' && hour === 12) hour = 0;
  var year = new Date().getFullYear();
  var d = new Date(year, mon, day, hour, min);
  // If date is far in the past (>6 months), assume next year
  if (d < new Date() - 180*86400000) d.setFullYear(year + 1);
  return d;
}

function smartSort(arr) {
  var now = new Date();
  return arr.slice().sort(function(a, b) {
    var dA = parseMeetingDate(a.meetingDate);
    var dB = parseMeetingDate(b.meetingDate);
    var hasA = dA !== null;
    var hasB = dB !== null;
    // Companies with meetings first, no meetings last
    if (hasA && !hasB) return -1;
    if (!hasA && hasB) return 1;
    if (!hasA && !hasB) {
      // Both no meetings: NO-GO at bottom, then by total score desc
      if (a.decision === 'nogo' && b.decision !== 'nogo') return 1;
      if (a.decision !== 'nogo' && b.decision === 'nogo') return -1;
      return getTotal(b) - getTotal(a);
    }
    // Both have meetings
    var futA = dA >= now;
    var futB = dB >= now;
    // Future meetings first (closest on top)
    if (futA && futB) return dA - dB;
    if (futA && !futB) return -1;
    if (!futA && futB) return 1;
    // Both past: most recent first
    return dB - dA;
  });
}

function renderTable() {
  var filtered = DATA;
  if (currentFilter === 'qualified') filtered = DATA.filter(isQualified);
  else if (currentFilter === 'booked') filtered = DATA.filter(c => c.status === 'booked');
  else if (currentFilter === 'done') filtered = DATA.filter(c => c.status === 'done');

  filtered = smartSort(filtered);

  var html = '';
  filtered.forEach(function(c, i) {
    var t = getTotal(c);
    var tClass = t >= 20 ? 'total-high' : t >= 18 ? 'total-mid' : 'total-low';
    var topBadge = t >= 20 ? '<span style="background:#059669;color:#fff;padding:2px 6px;border-radius:4px;font-size:9px;font-weight:700;margin-left:6px;vertical-align:middle">TOP</span>' : '';
    var rowBorder = t >= 20 ? 'border-left:3px solid #34d399;' : t < 18 ? 'border-left:3px solid #f87171;' : '';
    // Highlight upcoming meetings
    var meetDate = parseMeetingDate(c.meetingDate);
    var now = new Date();
    var urgentStyle = '';
    var meetBadge = '';
    if (meetDate) {
      var diffH = (meetDate - now) / 3600000;
      if (diffH > 0 && diffH <= 24) { urgentStyle = 'background:rgba(251,191,36,0.08);'; meetBadge = '<span style="background:#f59e0b;color:#000;padding:1px 6px;border-radius:4px;font-size:9px;font-weight:700;margin-left:6px;vertical-align:middle">–°–ï–ì–û–î–ù–Ø</span>'; }
      else if (diffH > 24 && diffH <= 48) { urgentStyle = 'background:rgba(56,189,248,0.06);'; meetBadge = '<span style="background:#0ea5e9;color:#fff;padding:1px 6px;border-radius:4px;font-size:9px;font-weight:700;margin-left:6px;vertical-align:middle">–ó–ê–í–¢–†–ê</span>'; }
      else if (diffH > 0 && diffH <= 168) { meetBadge = '<span style="background:#6366f1;color:#fff;padding:1px 6px;border-radius:4px;font-size:9px;font-weight:700;margin-left:6px;vertical-align:middle">–°–ö–û–†–û</span>'; }
    }
    var statusLabels = {none:'–ù–µ –Ω–∞—á–∞—Ç',contacted:'–§–æ—Ä–º–∞/Email',booked:'–ó–∞–±—É–∫–∞–Ω–∞',done:'‚úÖ –ü—Ä–æ–≤–µ–¥–µ–Ω–∞',rejected:'–ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç'};
    var decLabels = {pending:'‚è≥', go:'‚úÖ GO', nogo:'‚ùå NO-GO'};
    var decClass = {pending:'decision-pending', go:'decision-go', nogo:'decision-nogo'};
    html += `<tr data-id="${c.id}" style="${rowBorder}${urgentStyle}">
      <td style="color:#475569">${i+1}</td>
      <td><div class="company-name">${c.name}${topBadge}</div><div class="company-url"><a href="${c.url}" target="_blank">${c.url.replace('https://','')}</a></div></td>
      <td class="score-cell"><span class="score-badge score-${c.scores.s1}">${c.scores.s1}</span></td>
      <td class="score-cell"><span class="score-badge score-${c.scores.s2}">${c.scores.s2}</span></td>
      <td class="score-cell"><span class="score-badge score-${c.scores.s3}">${c.scores.s3}</span></td>
      <td class="score-cell"><span class="score-badge score-${c.scores.s4}">${c.scores.s4}</span></td>
      <td class="score-cell"><span class="score-badge score-${c.scores.s5}">${c.scores.s5}</span></td>
      <td class="total-score ${tClass}">${t}/25</td>
      <td><span class="status-badge status-${c.status}">${statusLabels[c.status]||c.status}</span></td>
      <td style="font-size:12px;white-space:nowrap">${c.meetingDate ? c.meetingDate + meetBadge + (c.meetingLink ? '<br><a href="'+c.meetingLink+'" target="_blank" style="color:#38bdf8;font-size:11px;font-weight:600;">üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</a>' : '') : '‚Äî'}</td>
      <td style="font-size:12px">${c.price||'‚Äî'}</td>
      <td style="font-size:12px">${c.launch||'‚Äî'}</td>
      <td><span class="${decClass[c.decision]}">${decLabels[c.decision]}</span></td>
      <td class="notes-cell">
        <span class="editable" title="${(c.notes||'').replace(/"/g,'&quot;')}" onclick="editRow(${c.id})">${c.notes ? c.notes.substring(0,50)+'...' : '–ù–∞–∂–º–∏ –¥–ª—è —Ä–µ–¥.'}</span>
        ${c.meetingSummary ? '<span class="summary-toggle" onclick="toggleSummary('+c.id+')">üìã –ò—Ç–æ–≥–∏ –≤—Å—Ç—Ä–µ—á–∏</span><div class="summary-panel" id="summary-'+c.id+'"><h4>–í–µ—Ä–¥–∏–∫—Ç</h4><div class="verdict verdict-'+c.meetingSummary.verdict+'">'+c.meetingSummary.verdictText+'</div><h4>–¶–µ–Ω—ã</h4>'+c.meetingSummary.pricing+'<h4>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h4>'+c.meetingSummary.keyContacts+'<h4>–ü–∞—Ä—Ç–Ω—ë—Ä—ã</h4>'+c.meetingSummary.partners+'<h4>–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏</h4>'+c.meetingSummary.nextSteps+'</div>' : ''}
      </td>
      <td><div class="row-actions">
        <button class="row-btn" onclick="editRow(${c.id})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
        <button class="row-btn" onclick="deleteRow(${c.id})" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
      </div></td>
    </tr>`;
  });
  document.getElementById('table-body').innerHTML = html;
}

function setFilter(f) {
  currentFilter = f;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
  renderTable();
}

function editRow(id) {
  editingId = id;
  var c = DATA.find(x => x.id === id);
  if (!c) return;
  document.getElementById('modal-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å: ' + c.name;
  document.getElementById('m-name').value = c.name;
  document.getElementById('m-url').value = c.url;
  document.getElementById('m-contact').value = c.contact || '';
  document.getElementById('m-s1').value = c.scores.s1;
  document.getElementById('m-s2').value = c.scores.s2;
  document.getElementById('m-s3').value = c.scores.s3;
  document.getElementById('m-s4').value = c.scores.s4;
  document.getElementById('m-s5').value = c.scores.s5;
  document.getElementById('m-status').value = c.status;
  document.getElementById('m-meeting-date').value = c.meetingDate || '';
  document.getElementById('m-meeting-link').value = c.meetingLink || '';
  document.getElementById('m-price').value = c.price || '';
  document.getElementById('m-launch').value = c.launch || '';
  document.getElementById('m-decision').value = c.decision || 'pending';
  document.getElementById('m-notes').value = c.notes || '';
  document.getElementById('edit-modal').classList.add('show');
}

function addCompany() {
  editingId = null;
  document.getElementById('modal-title').textContent = '–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é';
  ['m-name','m-url','m-contact','m-meeting-date','m-meeting-link','m-price','m-launch','m-notes'].forEach(id => document.getElementById(id).value = '');
  ['m-s1','m-s2','m-s3','m-s4','m-s5'].forEach(id => document.getElementById(id).value = '3');
  document.getElementById('m-status').value = 'none';
  document.getElementById('m-decision').value = 'pending';
  document.getElementById('edit-modal').classList.add('show');
}

function closeModal() { document.getElementById('edit-modal').classList.remove('show'); }

async function saveModal() {
  var obj = {
    name: document.getElementById('m-name').value,
    url: document.getElementById('m-url').value,
    contact: document.getElementById('m-contact').value,
    scores: {
      s1: parseInt(document.getElementById('m-s1').value),
      s2: parseInt(document.getElementById('m-s2').value),
      s3: parseInt(document.getElementById('m-s3').value),
      s4: parseInt(document.getElementById('m-s4').value),
      s5: parseInt(document.getElementById('m-s5').value)
    },
    status: document.getElementById('m-status').value,
    meetingDate: document.getElementById('m-meeting-date').value,
    meetingLink: document.getElementById('m-meeting-link').value,
    price: document.getElementById('m-price').value,
    launch: document.getElementById('m-launch').value,
    decision: document.getElementById('m-decision').value,
    notes: document.getElementById('m-notes').value
  };
  if (editingId) {
    var idx = DATA.findIndex(x => x.id === editingId);
    if (idx >= 0) {
      // Preserve meetingSummary if it exists
      if (DATA[idx].meetingSummary) obj.meetingSummary = DATA[idx].meetingSummary;
      obj.id = editingId;
      DATA[idx] = obj;
    }
  } else {
    obj.id = Math.max(0, ...DATA.map(x => x.id)) + 1;
    DATA.push(obj);
  }
  closeModal();
  renderAll();
  // Sync to Firestore
  await saveToFirestore(obj);
}

async function deleteRow(id) {
  if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–æ–º–ø–∞–Ω–∏—é?')) return;
  DATA = DATA.filter(x => x.id !== id);
  renderAll();
  // Sync delete to Firestore
  await deleteFromFirestore(id);
}

function toggleSummary(id) {
  var panel = document.getElementById('summary-' + id);
  if (panel) panel.classList.toggle('show');
}

function renderAll() { renderStats(); renderTable(); }

function saveFile() {
  var html = document.documentElement.outerHTML;
  var dataStr = 'var SEED_DATA = ' + JSON.stringify(DATA, null, 2) + ';';
  html = html.replace(/var SEED_DATA = \[[\s\S]*?\];/, dataStr);
  var blob = new Blob(['<!DOCTYPE html>\n<html lang="ru">\n' + html.split('<html lang="ru">')[1]], {type: 'text/html'});
  var a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'AVG_Telehealth_Tracker.html';
  a.click();
  URL.revokeObjectURL(a.href);
  alert('–§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω –∫–∞–∫ –±—ç–∫–∞–ø! –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Firebase.');
}

// Close modal on outside click
document.getElementById('edit-modal').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});

// ========== START APP ==========
initApp();
</script>
</body>
</html>
