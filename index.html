<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AVG Telehealth Partner Tracker</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f172a; color: #e2e8f0; min-height: 100vh; }
.header { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-bottom: 1px solid #334155; padding: 20px 32px; display: flex; justify-content: space-between; align-items: center; }
.header h1 { font-size: 22px; font-weight: 700; }
.header h1 span { color: #38bdf8; }
.header-actions { display: flex; gap: 10px; }
.btn { padding: 8px 18px; border-radius: 8px; border: none; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.2s; }
.btn-primary { background: #2563eb; color: white; }
.btn-primary:hover { background: #1d4ed8; }
.btn-success { background: #059669; color: white; }
.btn-success:hover { background: #047857; }
.btn-outline { background: transparent; border: 1px solid #475569; color: #94a3b8; }
.btn-outline:hover { border-color: #38bdf8; color: #38bdf8; }

.criteria-bar { background: #1e293b; border-bottom: 1px solid #334155; padding: 16px 32px; display: flex; gap: 16px; flex-wrap: wrap; align-items: center; }
.criteria-chip { background: #334155; padding: 6px 14px; border-radius: 20px; font-size: 12px; display: flex; align-items: center; gap: 6px; }
.criteria-chip .num { background: #2563eb; color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; }

.stats-bar { padding: 16px 32px; display: flex; gap: 16px; }
.stat-card { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 14px 20px; flex: 1; }
.stat-card .label { font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; }
.stat-card .value { font-size: 28px; font-weight: 700; margin-top: 4px; }
.stat-card .value.blue { color: #38bdf8; }
.stat-card .value.green { color: #34d399; }
.stat-card .value.amber { color: #fbbf24; }
.stat-card .value.red { color: #f87171; }

.filters { padding: 12px 32px; display: flex; gap: 10px; align-items: center; }
.filter-btn { padding: 6px 14px; border-radius: 6px; background: #1e293b; border: 1px solid #334155; color: #94a3b8; cursor: pointer; font-size: 12px; }
.filter-btn.active { background: #2563eb; border-color: #2563eb; color: white; }

.table-wrap { padding: 0 32px 32px; overflow-x: auto; }
table { width: 100%; border-collapse: collapse; font-size: 13px; }
thead th { background: #1e293b; padding: 10px 12px; text-align: left; font-weight: 600; color: #94a3b8; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; position: sticky; top: 0; border-bottom: 2px solid #334155; white-space: nowrap; }
tbody tr { border-bottom: 1px solid #1e293b; transition: background 0.15s; }
tbody tr:hover { background: #1e293b; }
tbody td { padding: 10px 12px; vertical-align: middle; }
.company-name { font-weight: 600; color: #f1f5f9; }
.company-url { font-size: 11px; color: #64748b; }
.company-url a { color: #38bdf8; text-decoration: none; }
    .email-link { margin-top: 3px; }
    .email-link a { color: #a78bfa; font-size: 11px; text-decoration: none; }
    .email-link a:hover { text-decoration: underline; color: #c4b5fd; }

.score-cell { text-align: center; }
.score-badge { display: inline-block; width: 28px; height: 28px; border-radius: 6px; line-height: 28px; text-align: center; font-weight: 700; font-size: 12px; }
.score-1 { background: #7f1d1d; color: #fca5a5; }
.score-2 { background: #78350f; color: #fcd34d; }
.score-3 { background: #713f12; color: #fde68a; }
.score-4 { background: #14532d; color: #86efac; }
.score-5 { background: #064e3b; color: #6ee7b7; }

.total-score { font-weight: 700; font-size: 16px; text-align: center; }
.total-high { color: #34d399; }
.total-mid { color: #fbbf24; }
.total-low { color: #f87171; }

.status-badge { padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; white-space: nowrap; }
.status-none { background: #374151; color: #9ca3af; }
.status-contacted { background: #1e3a5f; color: #60a5fa; }
.status-booked { background: #064e3b; color: #34d399; }
.status-done { background: #312e81; color: #a5b4fc; }
.status-rejected { background: #7f1d1d; color: #fca5a5; }

.editable { cursor: pointer; border-bottom: 1px dashed #475569; padding: 2px 4px; border-radius: 3px; min-width: 40px; display: inline-block; }
.editable:hover { background: #334155; }
.editable:focus { outline: 2px solid #2563eb; background: #1e293b; }

select.inline-select { background: #1e293b; border: 1px solid #475569; color: #e2e8f0; padding: 4px 8px; border-radius: 6px; font-size: 12px; cursor: pointer; }

.decision-go { color: #34d399; font-weight: 700; }
.decision-nogo { color: #f87171; font-weight: 700; }
.decision-pending { color: #94a3b8; }

.meeting-log-entry { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 10px 12px; margin-bottom: 8px; position: relative; }
.meeting-log-entry .log-date { color: #38bdf8; font-weight: 600; font-size: 12px; }
.meeting-log-entry .log-type { background: #334155; color: #94a3b8; padding: 2px 8px; border-radius: 10px; font-size: 10px; margin-left: 8px; }
.meeting-log-entry .log-type-first { background: #064e3b; color: #34d399; }
.meeting-log-entry .log-type-followup { background: #312e81; color: #a5b4fc; }
.meeting-log-entry .log-type-demo { background: #78350f; color: #fcd34d; }
.meeting-log-entry .log-summary { color: #cbd5e1; font-size: 12px; margin-top: 6px; line-height: 1.5; white-space: pre-wrap; }
.meeting-log-entry .log-delete { position: absolute; top: 8px; right: 8px; background: none; border: none; color: #475569; cursor: pointer; font-size: 12px; }
.meeting-log-entry .log-delete:hover { color: #f87171; }
.meetings-log-badge { background: #1e3a5f; color: #60a5fa; padding: 2px 8px; border-radius: 10px; font-size: 10px; cursor: pointer; margin-left: 4px; }
.meetings-log-badge:hover { background: #2563eb; color: #fff; }

.notes-cell { max-width: 200px; }
.notes-cell .editable { font-size: 11px; color: #94a3b8; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px; }

.modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 100; justify-content: center; align-items: center; }
.modal-overlay.show { display: flex; }
.modal { background: #1e293b; border: 1px solid #334155; border-radius: 16px; padding: 28px; width: 600px; max-width: 90vw; max-height: 80vh; overflow-y: auto; }
.modal h2 { font-size: 18px; margin-bottom: 20px; }
.modal label { display: block; font-size: 12px; color: #94a3b8; margin-bottom: 4px; margin-top: 12px; }
.modal input, .modal textarea, .modal select { width: 100%; background: #0f172a; border: 1px solid #475569; color: #e2e8f0; padding: 8px 12px; border-radius: 8px; font-size: 13px; }
.modal textarea { min-height: 80px; resize: vertical; }
.modal-actions { margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end; }

.score-input-group { display: flex; gap: 8px; margin-top: 12px; }
.score-input-item { flex: 1; text-align: center; }
.score-input-item label { font-size: 10px; }
.score-input-item select { text-align: center; }

.meeting-section { margin-top: 16px; padding-top: 16px; border-top: 1px solid #334155; }
.meeting-section h3 { font-size: 14px; color: #38bdf8; margin-bottom: 8px; }

.row-actions { display: flex; gap: 4px; }
.row-btn { background: none; border: none; cursor: pointer; padding: 4px; border-radius: 4px; color: #64748b; font-size: 14px; }
.row-btn:hover { background: #334155; color: #e2e8f0; }

.meeting-done-badge { display: inline-flex; align-items: center; gap: 4px; background: #312e81; color: #a5b4fc; padding: 3px 8px; border-radius: 6px; font-size: 10px; font-weight: 700; }
.meeting-done-badge .check { color: #34d399; font-size: 14px; }

.summary-toggle { cursor: pointer; color: #38bdf8; font-size: 11px; text-decoration: underline; margin-top: 4px; display: inline-block; }
.summary-toggle:hover { color: #7dd3fc; }

.summary-panel { display: none; background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 12px; margin-top: 8px; font-size: 11px; color: #cbd5e1; line-height: 1.5; max-height: 300px; overflow-y: auto; }
.summary-panel.show { display: block; }
.summary-panel h4 { color: #38bdf8; font-size: 12px; margin: 8px 0 4px; }
.summary-panel h4:first-child { margin-top: 0; }
.summary-panel ul { margin: 4px 0 4px 16px; }
.summary-panel .verdict { padding: 8px; border-radius: 6px; margin-top: 8px; font-weight: 600; }
.summary-panel .verdict-positive { background: #064e3b; color: #34d399; border: 1px solid #059669; }
.summary-panel .verdict-neutral { background: #78350f; color: #fcd34d; border: 1px solid #d97706; }
.summary-panel .verdict-negative { background: #7f1d1d; color: #fca5a5; border: 1px solid #dc2626; }

.task-badge { display: inline-flex; align-items: center; gap: 4px; padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 600; line-height: 1.3; max-width: 220px; }
.task-active { background: rgba(251,191,36,0.12); border: 1px solid #f59e0b; color: #fbbf24; }
.task-overdue { background: rgba(239,68,68,0.12); border: 1px solid #ef4444; color: #f87171; animation: pulse-red 2s infinite; }
.task-done { background: rgba(52,211,153,0.08); border: 1px solid #334155; color: #64748b; text-decoration: line-through; }
.task-none { color: #475569; font-size: 11px; }
.task-responsible { font-size: 9px; color: #94a3b8; margin-top: 2px; }
.task-deadline { font-size: 10px; font-weight: 700; }
.task-deadline.urgent { color: #f87171; }
.task-deadline.soon { color: #fbbf24; }
.task-deadline.normal { color: #94a3b8; }
.task-text { display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 180px; }
@keyframes pulse-red { 0%,100% { opacity: 1; } 50% { opacity: 0.7; } }

.contacts-toggle { cursor: pointer; color: #38bdf8; font-size: 11px; text-decoration: underline; margin-top: 4px; display: inline-block; }
.contacts-toggle:hover { color: #7dd3fc; }

.contacts-panel { display: none; background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 12px; margin-top: 8px; font-size: 11px; color: #cbd5e1; line-height: 1.5; max-height: 300px; overflow-y: auto; }
.contacts-panel.show { display: block; }

.pros-cons { margin-top: 8px; }
.pro-item { color: #34d399; font-size: 11px; margin: 2px 0; }
.con-item { color: #f87171; font-size: 11px; margin: 2px 0; }

.checklist-item { font-size: 11px; margin: 2px 0; cursor: pointer; }
.checklist-panel { margin-top: 8px; }
</style>
</head>
<body>

<div class="header">
  <h1>AVG <span>Telehealth Partner Tracker</span></h1>
  <div class="header-actions">
    <button class="btn btn-outline" onclick="addCompany()">+ ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ñ</button>
    <button class="btn btn-success" onclick="saveFile()">ð¾ Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ ÑÐ°Ð¹Ð»</button>
  </div>
</div>

<div class="criteria-bar">
  <span style="font-size:12px;color:#64748b;margin-right:4px;">ÐÑÐ¸ÑÐµÑÐ¸Ð¸ (1-5):</span>
  <div class="criteria-chip"><span class="num">1</span> ÐÐ¾ÑÑÐ°Ð²ÐºÐ° Ð²ÑÐ°ÑÐµÐ¹</div>
  <div class="criteria-chip"><span class="num">2</span> 50 ÑÑÐ°ÑÐ¾Ð²</div>
  <div class="criteria-chip"><span class="num">3</span> White-label + BYO pharmacy</div>
  <div class="criteria-chip"><span class="num">4</span> TRT/HRT/Ð¿ÐµÐ¿ÑÐ¸Ð´Ñ/WL</div>
  <div class="criteria-chip"><span class="num">5</span> Ð¦ÐµÐ½Ð¾Ð²Ð°Ñ Ð¼Ð¾Ð´ÐµÐ»Ñ</div>
  <span style="font-size:11px;color:#475569;margin-left:8px;">ÐÑÐ¾ÑÐ¾Ð´Ð½Ð¾Ð¹ Ð±Ð°Ð»Ð»: â¥18/25</span>
</div>

<div class="stats-bar" id="stats-bar"></div>

<div class="filters">
  <span style="font-size:12px;color:#64748b;">Ð¤Ð¸Ð»ÑÑÑ:</span>
  <button class="filter-btn active" onclick="setFilter('all')">ÐÑÐµ</button>
  <button class="filter-btn" onclick="setFilter('qualified')">ÐÐ²Ð°Ð»Ð¸ÑÐ¸ÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð½ÑÐµ</button>
  <button class="filter-btn" onclick="setFilter('booked')">ÐÑÑÑÐµÑÐ° Ð·Ð°Ð±ÑÐºÐ°Ð½Ð°</button>
  <button class="filter-btn" onclick="setFilter('done')">ÐÑÑÑÐµÑÐ° Ð¿ÑÐ¾Ð²ÐµÐ´ÐµÐ½Ð°</button>
  <button class="filter-btn" onclick="setFilter('tasks')">ð¥ ÐÐºÑÐ¸Ð²Ð½ÑÐµ Ð·Ð°Ð´Ð°ÑÐ¸</button>
</div>

<div class="table-wrap">
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>ÐÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ñ</th>
        <th class="score-cell">ÐÑÐ°ÑÐ¸</th>
        <th class="score-cell">50 ÑÑ.</th>
        <th class="score-cell">WL+Pharm</th>
        <th class="score-cell">Ð ÐµÐ»ÐµÐ².</th>
        <th class="score-cell">Ð¦ÐµÐ½Ð°</th>
        <th class="score-cell">ÐÑÐ¾Ð³Ð¾</th>
        <th>Ð¡ÑÐ°ÑÑÑ</th>
        <th>ÐÑÑÑÐµÑÐ° / Zoom</th>
        <th>Ð¦ÐµÐ½Ð°/Ð²Ð¸Ð·Ð¸Ñ</th>
        <th>ÐÐ°Ð¿ÑÑÐº</th>
        <th>Ð ÐµÑÐµÐ½Ð¸Ðµ</th>
        <th>ÐÐ°Ð´Ð°ÑÐ° / Next Step</th>
        <th>ÐÐ°Ð¼ÐµÑÐºÐ¸</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="table-body"></tbody>
  </table>
</div>

<!-- Edit Modal -->
<div class="modal-overlay" id="edit-modal">
  <div class="modal">
    <h2 id="modal-title">Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ñ</h2>
    <label>ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ</label>
    <input id="m-name" placeholder="Company Name">
    <label>Ð¡Ð°Ð¹Ñ</label>
    <input id="m-url" placeholder="https://...">
    <label>ÐÐ¾Ð½ÑÐ°ÐºÑ (URL/email Ð´Ð»Ñ Ð±ÑÐºÐ¸Ð½Ð³Ð°)</label>
    <input id="m-contact" placeholder="https://... Ð¸Ð»Ð¸ email">

    <div class="score-input-group">
      <div class="score-input-item"><label>ÐÑÐ°ÑÐ¸</label><select id="m-s1"><option>1</option><option>2</option><option>3</option><option selected>4</option><option>5</option></select></div>
      <div class="score-input-item"><label>50 ÑÑ.</label><select id="m-s2"><option>1</option><option>2</option><option>3</option><option selected>4</option><option>5</option></select></div>
      <div class="score-input-item"><label>WL+Pharm</label><select id="m-s3"><option>1</option><option>2</option><option>3</option><option selected>4</option><option>5</option></select></div>
      <div class="score-input-item"><label>Ð ÐµÐ»ÐµÐ².</label><select id="m-s4"><option>1</option><option>2</option><option>3</option><option selected>4</option><option>5</option></select></div>
      <div class="score-input-item"><label>Ð¦ÐµÐ½Ð°</label><select id="m-s5"><option>1</option><option>2</option><option>3</option><option selected>4</option><option>5</option></select></div>
    </div>

    <label>Ð¡ÑÐ°ÑÑÑ</label>
    <select id="m-status">
      <option value="none">ÐÐµ Ð½Ð°ÑÐ°Ñ</option>
      <option value="contacted">Ð¤Ð¾ÑÐ¼Ð°/Email Ð¾ÑÐ¿ÑÐ°Ð²Ð»ÐµÐ½</option>
      <option value="booked">ÐÑÑÑÐµÑÐ° Ð·Ð°Ð±ÑÐºÐ°Ð½Ð°</option>
      <option value="done">ÐÑÑÑÐµÑÐ° Ð¿ÑÐ¾Ð²ÐµÐ´ÐµÐ½Ð°</option>
      <option value="rejected">ÐÐµ Ð¿Ð¾Ð´ÑÐ¾Ð´Ð¸Ñ</option>
    </select>

    <div class="meeting-section">
      <h3>ÐÐ¾ÑÐ»Ðµ Ð²ÑÑÑÐµÑÐ¸</h3>
      <label>ÐÐ°ÑÐ°/Ð²ÑÐµÐ¼Ñ Ð²ÑÑÑÐµÑÐ¸</label>
      <input id="m-meeting-date" placeholder="Feb 27, 10:00 AM ET">
      <label>Ð¡ÑÑÐ»ÐºÐ° Ð½Ð° Zoom/Meet</label>
      <input id="m-meeting-link" placeholder="https://zoom.us/j/... Ð¸Ð»Ð¸ https://meet.google.com/...">
      <label>Ð¦ÐµÐ½Ð° Ð·Ð° Ð²Ð¸Ð·Ð¸Ñ / Ð¼Ð¾Ð´ÐµÐ»Ñ</label>
      <input id="m-price" placeholder="$75/consult, $X/month, rev-share...">
      <label>Ð¡ÐºÐ¾ÑÐ¾ÑÑÑ Ð·Ð°Ð¿ÑÑÐºÐ°</label>
      <input id="m-launch" placeholder="2-4 weeks, 30 days, etc.">
      <label>Ð ÐµÑÐµÐ½Ð¸Ðµ</label>
      <select id="m-decision">
        <option value="pending">ÐÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ</option>
        <option value="go">GO â</option>
        <option value="nogo">NO-GO â</option>
      </select>
      <label>ÐÐ°Ð¼ÐµÑÐºÐ¸</label>
      <textarea id="m-notes" placeholder="ÐÐ»ÑÑÐµÐ²ÑÐµ Ð¼Ð¾Ð¼ÐµÐ½ÑÑ, Ð²Ð¿ÐµÑÐ°ÑÐ»ÐµÐ½Ð¸Ñ, ÐºÐ¾Ð½ÑÐ°ÐºÑÑ..."></textarea>
    </div>

    <div class="meeting-section">
      <h3>ð ÐÐ°Ð´Ð°ÑÐ° / Next Step</h3>
      <label>Ð§ÑÐ¾ Ð½ÑÐ¶Ð½Ð¾ ÑÐ´ÐµÐ»Ð°ÑÑ</label>
      <input id="m-next-task" placeholder="ÐÐ¾Ð»ÑÑÐ¸ÑÑ proposal, Ð½Ð°Ð·Ð½Ð°ÑÐ¸ÑÑ follow-up, Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ°ÑÑ ÐºÐ¾Ð½ÑÑÐ°ÐºÑ...">
      <label>ÐÐµÐ´Ð»Ð°Ð¹Ð½</label>
      <input id="m-task-deadline" placeholder="Mar 5 Ð¸Ð»Ð¸ 2025-03-05">
      <label>ÐÑÐ²ÐµÑÑÑÐ²ÐµÐ½Ð½ÑÐ¹</label>
      <input id="m-task-responsible" placeholder="ÐÐ¼Ñ Ð¾ÑÐ²ÐµÑÑÑÐ²ÐµÐ½Ð½Ð¾Ð³Ð¾ (Ð½Ð°Ð¿Ñ. Alina Rakhimzhanova)">
      <label style="display:inline-flex;align-items:center;gap:8px;margin-top:8px">
        <input type="checkbox" id="m-task-done" style="width:auto"> ÐÐ°Ð´Ð°ÑÐ° Ð²ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð°
      </label>
    </div>

    <div class="meeting-section">
      <h3>ð¥ ÐÐ¾Ð½ÑÐ°ÐºÑÑ</h3>
      <label>ÐÐ¾Ð½ÑÐ°ÐºÑÐ½Ð¾Ðµ Ð»Ð¸ÑÐ¾</label>
      <input id="m-contact-name" placeholder="ÐÐ¼Ñ ÐºÐ¾Ð½ÑÐ°ÐºÑÐ½Ð¾Ð³Ð¾ Ð»Ð¸ÑÐ°">
      <label>Email</label>
      <input id="m-contact-email" placeholder="email@company.com">
      <label>Ð¢ÐµÐ»ÐµÑÐ¾Ð½ / WhatsApp</label>
      <input id="m-contact-phone" placeholder="+1 234 567 8900">
      <label>ÐÐ¾Ð»Ð¶Ð½Ð¾ÑÑÑ</label>
      <input id="m-contact-role" placeholder="CEO, Account Manager, etc.">
    </div>

    <div class="meeting-section">
      <h3>ðª Ð¡Ð¸Ð»ÑÐ½ÑÐµ / Ð¡Ð»Ð°Ð±ÑÐµ ÑÑÐ¾ÑÐ¾Ð½Ñ</h3>
      <label>Ð¡Ð¸Ð»ÑÐ½ÑÐµ ÑÑÐ¾ÑÐ¾Ð½Ñ (ÑÐµÑÐµÐ· ;)</label>
      <textarea id="m-pros" placeholder="50 ÑÑÐ°ÑÐ¾Ð²; ÐÑÑÑÑÑÐ¹ Ð·Ð°Ð¿ÑÑÐº; Ð¥Ð¾ÑÐ¾ÑÐ¸Ðµ ÑÐµÐ½Ñ"></textarea>
      <label>Ð¡Ð»Ð°Ð±ÑÐµ ÑÑÐ¾ÑÐ¾Ð½Ñ (ÑÐµÑÐµÐ· ;)</label>
      <textarea id="m-pros-cons" placeholder="ÐÐµÑ TRT; ÐÐ¾Ð»Ð³Ð¸Ð¹ Ð¾Ð½Ð±Ð¾ÑÐ´Ð¸Ð½Ð³"></textarea>
    </div>

    <div class="meeting-section">
      <h3>â Ð§ÐµÐºÐ»Ð¸ÑÑ Ð²Ð¾Ð¿ÑÐ¾ÑÐ¾Ð²</h3>
      <label>ÐÐ¾Ð¿ÑÐ¾ÑÑ (ÑÐµÑÐµÐ· ; â Ð¼Ð¾Ð¶Ð½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸ÑÑ [x] Ð´Ð»Ñ Ð¾ÑÐ¼ÐµÑÐµÐ½Ð½ÑÑ)</label>
      <textarea id="m-checklist" placeholder="Blood tests?; ÐÐ¾Ð¶ÐµÐ¼ Ð»Ð¸ Ð²Ð¸Ð´ÐµÑÑ Ð¿ÑÐµÑÐºÑÐ¸Ð¿ÑÐ½Ñ?; [x] Ð£Ð¶Ðµ ÑÑÐ¾ÑÐ½Ð¸Ð»Ð¸ ÑÐµÐ½Ñ"></textarea>
    </div>

    <div class="meeting-section">
      <h3>ð ÐÐ¾Ð³ Ð²ÑÑÑÐµÑ</h3>
      <div id="m-meetings-log" style="margin-bottom:10px"></div>
      <div style="background:#0f172a;border:1px solid #475569;border-radius:8px;padding:12px;margin-top:8px">
        <label style="color:#38bdf8;font-weight:600">+ ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ Ð·Ð°Ð¿Ð¸ÑÑ Ð¾ Ð²ÑÑÑÐµÑÐµ</label>
        <input id="m-meeting-log-date" placeholder="Feb 27, 2026" style="margin-top:6px">
        <select id="m-meeting-log-type" style="margin-top:4px">
          <option value="first">ÐÐµÑÐ²Ð¸ÑÐ½Ð°Ñ Ð²ÑÑÑÐµÑÐ°</option>
          <option value="followup">Follow-up</option>
          <option value="demo">ÐÐµÐ¼Ð¾ / ÐÑÐµÐ·ÐµÐ½ÑÐ°ÑÐ¸Ñ</option>
          <option value="call">ÐÐ²Ð¾Ð½Ð¾Ðº</option>
          <option value="email">Email-Ð¿ÐµÑÐµÐ¿Ð¸ÑÐºÐ°</option>
        </select>
        <textarea id="m-meeting-log-summary" placeholder="ÐÐ¾ÑÐ¾ÑÐºÐ¾: Ð¾ ÑÑÐ¼ Ð³Ð¾Ð²Ð¾ÑÐ¸Ð»Ð¸, ÐºÐ»ÑÑÐµÐ²ÑÐµ Ð²ÑÐ²Ð¾Ð´Ñ, ÑÑÐ¾ ÑÐµÑÐ¸Ð»Ð¸" style="margin-top:4px;min-height:80px"></textarea>
        <button class="btn btn-primary" style="margin-top:6px;width:100%" onclick="addMeetingLog()">ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ Ð·Ð°Ð¿Ð¸ÑÑ</button>
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn btn-outline" onclick="closeModal()">ÐÑÐ¼ÐµÐ½Ð°</button>
      <button class="btn btn-primary" onclick="saveModal()">Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ</button>
    </div>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<script>
// ========== FIREBASE CONFIG ==========
firebase.initializeApp({
  apiKey: "AIzaSyAvNGtUi6xoV_cMozgsDfJ9qfhOPvRe7N0",
  authDomain: "adv-meetings.firebaseapp.com",
  projectId: "adv-meetings",
  storageBucket: "adv-meetings.firebasestorage.app",
  messagingSenderId: "1044887682497",
  appId: "1:1044887682497:web:cc7944ddd314ea79144340"
});
var db = firebase.firestore();
var COLLECTION = 'companies';

// ========== DATA (fallback seed â used only if Firestore is empty) ==========
var SEED_DATA = [
  // ===== ÐÐÐÐ£ÐÐÐÐÐ«Ð ÐÐ¡Ð¢Ð ÐÐ§Ð (Ð¿Ð¾ Ð´Ð°ÑÐµ) =====
  {
    id: 7, name: "DrCare247", url: "https://drcare247.com", contact: "https://www.drcare247.com/",
    scores: {s1:4, s2:5, s3:3, s4:2, s5:2},
    status: "done", meetingDate: "Feb 26, 1:30 PM ET (ÑÑ)", price: "$5000 setup + $500/Ð¼ÐµÑ + $1000/Ð¼ÐµÑ Ð¼Ð¸Ð½ (20 ÐºÐ¾Ð½ÑÑÐ»ÑÑÐ°ÑÐ¸Ð¹) + $50/ÐºÐ¾Ð½ÑÑÐ»ÑÑ ÑÐ²ÐµÑÑ", launch: "2-4 Ð½ÐµÐ´ÐµÐ»Ð¸ Ð¿Ð¾ÑÐ»Ðµ ÐºÐ¾Ð½ÑÑÐ°ÐºÑÐ°", decision: "pending",
    meetingLink: "https://us06web.zoom.us/j/89130178538?pwd=lxfiPffWmRPxGM1POOGN5iYkPBj6E.1",
    notes: "â ÐÐ¡Ð¢Ð ÐÐ§Ð ÐÐ ÐÐÐÐÐÐÐ 26 ÑÐµÐ². ÐÐ¾Ð½ÑÐ°ÐºÑ: Shafi Ahamed, ÑÐµÐ»: +917708614041 / US: +1 6302306699. Ð Ð°Ð±Ð¾ÑÐ°ÑÑ ÑÐµÑÐµÐ· WebDoctors (webdoctors.com/meet-the-doctor) â 6 Ð²ÑÐ°ÑÐµÐ¹, board-certified MDs, Ð²ÑÐµ 50 ÑÑÐ°ÑÐ¾Ð², Chicago-based Ð´Ð¾ 10 PM CT. ÐÐ¿ÑÐµÐºÐ°: Belmar Pharma Solutions (belmarpharmasolutions.com), Ð¼Ð¾Ð³ÑÑ Ð¿Ð¾Ð´ÐºÐ»ÑÑÐ¸ÑÑ Empower. Turnkey: intake â eligibility â ÐºÐ¾Ð½ÑÑÐ»ÑÑÐ°ÑÐ¸Ñ (video/phone, 15-30 Ð¼Ð¸Ð½ callback) â Rx â shipping 24-48Ñ. SSO + patient portal + Shopify Ð¸Ð½ÑÐµÐ³ÑÐ°ÑÐ¸Ñ + GoHighLevel CRM + PracticeQ. ÐÑÐ¾ÑÐ¾ÐºÐ¾Ð»Ñ TRT/GLP/ED ÑÑÐ°Ð½Ð´Ð°ÑÑÐ½ÑÐµ Ð¸Ð»Ð¸ ÑÐ²Ð¾Ð¸. HIPAA, BAA, MSO ÐºÐ¾Ð½ÑÑÐ°ÐºÑÑ. Ð¦ÐµÐ½Ð°: $5K setup, $500/Ð¼ÐµÑ tech, $1000/Ð¼ÐµÑ Ð¼Ð¸Ð½ Ð·Ð° 20 ÐºÐ¾Ð½ÑÑÐ»ÑÑÐ¾Ð², Ð´Ð°Ð»ÐµÐµ $50/ÐºÐ¾Ð½ÑÑÐ»ÑÑ. ÐÐ¸Ð½ÑÑÑ: Ð½ÐµÑ ÑÐ¾ÑÐ½Ð¾Ð³Ð¾ ÑÐ»Ð¾ÑÐ¾Ð²Ð¾Ð³Ð¾ ÑÐ°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ñ (ÑÐ¾Ð»ÑÐºÐ¾ callback 15-30 Ð¼Ð¸Ð½), Ð¿ÐµÐ¿ÑÐ¸Ð´Ñ â Ð½Ðµ Ð²Ð¾ Ð²ÑÐµÑ ÑÑÐ°ÑÐ°Ñ. Ð¡ÐÐÐÐ£Ð®Ð©ÐÐ Ð¨ÐÐ: Ð¿Ð¾Ð»ÑÑÐ¸ÑÑ proposal Ñ ÑÐµÐ½Ð°Ð¼Ð¸ Ð¾Ñ Shafi, Ð½Ð°Ð·Ð½Ð°ÑÐ¸ÑÑ follow-up Ð·Ð²Ð¾Ð½Ð¾Ðº.",
    meetingSummary: {
      verdict: "positive",
      verdictText: "Ð¥Ð¾ÑÐ¾ÑÐ¸Ð¹ ÐºÐ°Ð½Ð´Ð¸Ð´Ð°Ñ â Ð¿Ð¾ÐºÑÑÐ²Ð°ÐµÑ Ð²ÑÐµ 50 ÑÑÐ°ÑÐ¾Ð², turnkey ÑÐµÑÐµÐ½Ð¸Ðµ, ÑÐ°Ð·ÑÐ¼Ð½Ð°Ñ ÑÐµÐ½Ð°. ÐÑÐ¶Ð½Ð¾ ÑÑÐ¾ÑÐ½Ð¸ÑÑ ÑÐ»Ð¾ÑÑ Ð¸ Ð¿ÐµÐ¿ÑÐ¸Ð´Ñ.",
      pricing: "$5000 setup + $500/Ð¼ÐµÑ tech + $1000/Ð¼ÐµÑ Ð¼Ð¸Ð½Ð¸Ð¼ÑÐ¼ (20 ÐºÐ¾Ð½ÑÑÐ»ÑÑÐ¾Ð²) + $50/ÐºÐ¾Ð½ÑÑÐ»ÑÑ Ð´Ð°Ð»ÐµÐµ",
      nextSteps: "ÐÐ¾Ð»ÑÑÐ¸ÑÑ proposal, Ð½Ð°Ð·Ð½Ð°ÑÐ¸ÑÑ follow-up Ð·Ð²Ð¾Ð½Ð¾Ðº Ñ Shafi (+1 6302306699)",
      keyContacts: "Shafi Ahamed: +917708614041 / US: +1 6302306699",
      partners: "WebDoctors (webdoctors.com), Belmar Pharma (belmarpharmasolutions.com)"
    }
  },
  {
    id: 8, name: "Qualiphy", url: "https://qualiphy.me", contact: "lorena@qualiphy.me",
    scores: {s1:2, s2:4, s3:2, s4:3, s5:2},
    status: "booked", meetingDate: "Feb 27, 10:00 AM ET (Ð¿Ñ)", price: "$27.99/Ð²Ð¸Ð·Ð¸Ñ", launch: "", decision: "pending",
    meetingLink: "https://meet.google.com/xmq-ztmu-ysa",
    notes: "ÐÑÑÑÐµÑÐ° Ð¿Ñ 27 ÑÐµÐ² 10:00-10:30 AM ET. 'Qualiphy GFE & Rx Fulfillment Solution' Ñ Lorena Santiago (lorena@qualiphy.me). Google Meet: meet.google.com/xmq-ztmu-ysa. Calendly: calendly.com/events/a4cf7a11-31af-48dc-a5b9-2e555654b21e/google_meet. Pay-per-consult Ð¼Ð°ÑÐºÐµÑÐ¿Ð»ÐµÐ¹Ñ ($27.99/Ð²Ð¸Ð·Ð¸Ñ). Ð£ÑÐ¾ÑÐ½Ð¸ÑÑ Ð¼Ð¾Ð´ÐµÐ»Ñ."
  },
  {
    id: 13, name: "Bask Health", url: "https://bask.health", contact: "https://bask.health/",
    scores: {s1:3, s2:3, s3:4, s4:3, s5:3},
    status: "booked", meetingDate: "Feb 27, 11:30 AM ET (Ð¿Ñ)", price: "", launch: "", decision: "pending",
    meetingLink: "https://meet.google.com/ohw-zxmi-sqa",
    notes: "Intro & Demo Ð¿Ñ 27 ÑÐµÐ² 11:30 AM Ñ Susanna Lewis. Google Meet: meet.google.com/ohw-zxmi-sqa. ÐÐ»Ð°ÑÑÐ¾ÑÐ¼Ð° Private Beta. Ð¡Ð¾ÑÑ: EMR, Compounding, Pharmacy, Order Mgmt. Ð£ÑÐ¾ÑÐ½Ð¸ÑÑ: Ð¿Ð¾ÑÑÐ°Ð²Ð»ÑÑÑ Ð»Ð¸ Ð²ÑÐ°ÑÐµÐ¹ Ð¸Ð»Ð¸ ÑÐ¾Ð»ÑÐºÐ¾ Ð¿Ð»Ð°ÑÑÐ¾ÑÐ¼Ñ."
  },
  {
    id: 12, name: "White Label Rx", url: "https://whitelblrx.com", contact: "https://whitelblrx.com/",
    scores: {s1:5, s2:5, s3:4, s4:5, s5:3},
    status: "booked", meetingDate: "Feb 27, 1:30 PM ET (Ð¿Ñ)", price: "", launch: "", decision: "pending",
    meetingLink: "https://us06web.zoom.us/j/84051750039?pwd=aJBtBjiZ9cMfXfzxDLOw4bajCZ880s.1",
    notes: "â­ GREAT FIT 22/25! ÐÑ 27 ÑÐµÐ² 1:30 PM. Zoom Ñ Richard KÃ¶hn (smartdoctors.us), pwd: 216710. ÐÑÐ°ÑÐ¸ 50 ÑÑÐ°ÑÐ¾Ð² + Puerto Rico. ED, Weight Loss, OTC. Pharmacy integration. White-label, HIPAA. ÐÐ ÐÐÐ ÐÐ¢ÐÐ¢ #2!"
  },
  {
    id: 10, name: "Beluga Health", url: "https://belugahealth.com", contact: "https://www.belugahealth.com/",
    scores: {s1:5, s2:5, s3:4, s4:3, s5:3},
    status: "booked", meetingDate: "Mar 1, 9:20 AM ET (Ð²Ñ)", price: "", launch: "", decision: "pending",
    meetingLink: "https://meet.google.com/yng-dbvd-ctw",
    notes: "â­ GOOD FIT 20/25. ÐÑ 1 Ð¼Ð°ÑÑÐ° 9:20-9:40 AM ET, Google Meet, Discovery Call Ñ Joshua Kishineff (joshua@belugahealth.com). Physician-only network, all 50 states. True white-label, DTC-native. ÐÐµÑÐµÐ½Ð¾Ñ: https://beluga-health.cal.com/booking/sDSH2apioFB89Nn1TMvoDH"
  },
  {
    id: 6, name: "Ola Digital Health", url: "https://oladigital.health", contact: "https://scheduler.zoom.us/alpeshrph/ola-digital-health-",
    scores: {s1:4, s2:5, s3:4, s4:4, s5:3},
    status: "booked", meetingDate: "Mar 2, 2:45 PM ET (Ð¿Ð½)", price: "", launch: "", decision: "pending",
    meetingLink: "https://us02web.zoom.us/j/7572757275?omn=85426982367",
    notes: "ÐÐ½ 2 Ð¼Ð°ÑÑÐ° 14:45-15:30 ET, Zoom Ñ Alpesh Patel (therxcare@gmail.com). Ð£ÑÐ°ÑÑÐ½Ð¸ÐºÐ¸: het, dhwani, sakshi, alpesh @oladigital.health. Ð¡ÐµÑÑ Ð²ÑÐ°ÑÐµÐ¹ Ð²Ð¾ Ð²ÑÐµÑ 50 ÑÑÐ°ÑÐ°Ñ."
  },
  {
    id: 15, name: "White Label MD", url: "https://whitelabelmd.com", contact: "https://launch.whitelabelmd.com/",
    scores: {s1:4, s2:4, s3:4, s4:3, s5:3},
    status: "booked", meetingDate: "Mar 4, 2:00 PM ET (ÑÑ)", price: "", launch: "", decision: "pending",
    meetingLink: "https://meet.google.com/kkn-ghnv-mqn",
    notes: "â­ 18/25. ÐÐ¡Ð¢Ð ÐÐ§Ð ÐÐÐÐ£ÐÐÐÐ ÑÑ 4 Ð¼Ð°ÑÑÐ° 2:00 PM ET Ñ Justin Champion (justin.champion@whitelabelmd.com). Google Meet: meet.google.com/kkn-ghnv-mqn. Justin ÐÐ ÐÐÐ¯Ð Ð¿ÑÐ¸Ð³Ð»Ð°ÑÐµÐ½Ð¸Ðµ. 'We can help' â Ð¾ÑÐ²ÐµÑÐ¸Ð» Ð¼Ð³Ð½Ð¾Ð²ÐµÐ½Ð½Ð¾. 100+ founders Ð·Ð°Ð¿ÑÑÑÐ¸Ð»Ð¸ÑÑ Ð·Ð° 6 Ð¼ÐµÑ. E-commerce telemedicine + on-demand Rx fulfillment. Turnkey white-label."
  },
  // ===== CONTACTED (Ð¿Ð¾ Ð±Ð°Ð»Ð»Ð°Ð¼ â Ð²ÑÑÑÐ¸Ðµ Ð¿ÐµÑÐ²ÑÐµ) =====
  {
    id: 2, name: "OpenLoop Health", url: "https://openloophealth.com", contact: "https://openloophealth.com/contact-sales",
    scores: {s1:5, s2:5, s3:5, s4:5, s5:3},
    status: "booked", meetingDate: "Mar 2, 3:30 PM ET (Ð¿Ð½)", price: "", launch: "", decision: "pending",
    meetingLink: "https://meet.google.com/ugz-zbvu-rss",
    notes: "â­ TOP FIT 23/25! ÐÐ¡Ð¢Ð ÐÐ§Ð ÐÐÐÐ£ÐÐÐÐ Ð¿Ð½ 2 Ð¼Ð°ÑÑÐ° 3:30-4:00 PM EST. Google Meet: meet.google.com/ugz-zbvu-rss. ÐÐ¾Ð½ÑÐ°ÐºÑ: Jordan Narlock (jordan.narlock@openloophealth.com) + Emma Evans (emma.evans@openloophealth.com, Sales Dev Rep). â ï¸ Ð¡ÑÐ°Ð·Ñ Ð¿Ð¾ÑÐ»Ðµ Ola Digital Health (2:45-3:30 PM) â Ð¿Ð»Ð¾ÑÐ½Ð¾Ðµ ÑÐ°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ! 20k ÐºÐ»Ð¸Ð½Ð¸ÑÐ¸ÑÑÐ¾Ð². ÐÑÐµ 50 ÑÑÐ°ÑÐ¾Ð². Weight loss, longevity, sexual health. Full white-label. 'Full-stack, white-labeled solutions'."
  },
  {
    id: 9, name: "MD Integrations", url: "https://mdintegrations.com", contact: "https://mdintegrations.com/faq",
    scores: {s1:5, s2:5, s3:4, s4:5, s5:4},
    status: "booked", meetingDate: "Mar 3, 2:00 PM ET (Ð²Ñ)", price: "", launch: "", decision: "pending",
    meetingLink: "https://mdintegrations.zoom.us/j/89683357553?pwd=qBQ0s8erdNrSMvdaKZaENkRkOfBQ4H.1",
    notes: "â­ PERFECT FIT 23/25! ÐÐ ÐÐÐ ÐÐ¢ÐÐ¢ #1! ÐÐ¡Ð¢Ð ÐÐ§Ð ÐÐÐÐ£ÐÐÐÐ Ð²Ñ 3 Ð¼Ð°ÑÑÐ° 2:00 PM EST. Zoom: mdintegrations.zoom.us/j/89683357553, Meeting ID: 896 8335 7553, Passcode: 167Mff. ÐÐ¾Ð½ÑÐ°ÐºÑ: Alyssa Foxson, MS (a.fox@mdintegrations.com, Inside Sales). Doctor-founded, 50 states, API-first. ÐÑ ÐºÐ°Ð»ÐµÐ½Ð´Ð°ÑÑ: calendar.app.google/k4wQiF3TBEu7dFBK6."
  },
  {
    id: 1, name: "SteadyMD", url: "https://steadymd.com", contact: "https://www.steadymd.com/contact/",
    scores: {s1:5, s2:5, s3:4, s4:5, s5:3},
    status: "contacted", meetingDate: "", price: "", launch: "", decision: "pending",
    meetingLink: "",
    notes: "â­ ÐÐ¢ÐÐÐ¢ Ð¾Ñ Lindsey Anderson (VP Enterprise Sales, lindsey@steadymd.com) 26 ÑÐµÐ². ÐÑÐ¾ÑÐ¸Ñ Ð´ÐµÑÐ°Ð»Ð¸: ÐºÐ°ÐºÐ¸Ðµ Ð¼ÐµÐ´. Ð½Ð°Ð¿ÑÐ°Ð²Ð»ÐµÐ½Ð¸Ñ, Ð¼Ð°ÑÑÑÐ°Ð±, ÑÐµÐºÑÑÐ¸Ðµ/Ð½Ð¾Ð²ÑÐµ Ð¿Ð°ÑÐ¸ÐµÐ½ÑÑ. ÐÐ£ÐÐÐ ÐÐ¢ÐÐÐ¢ÐÐ¢Ð¬ Ñ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸ÐµÐ¼ TRT/HRT Ð¿ÑÐ¾Ð³ÑÐ°Ð¼Ð¼Ñ. Ð¡Ð¾ÑÐ½Ð¸ Ð²ÑÐ°ÑÐµÐ¹ Ð²Ð¾ Ð²ÑÐµÑ 50 ÑÑÐ°ÑÐ°Ñ. ÐÐ°ÑÑÐ½ÑÑÑ Amazon Clinic."
  },
  {
    id: 4, name: "WellSync", url: "https://wellsync.com", contact: "https://wellsync.com/contact/",
    scores: {s1:4, s2:3, s3:4, s4:5, s5:3},
    status: "contacted", meetingDate: "", price: "", launch: "", decision: "pending",
    meetingLink: "",
    notes: "Ð¤Ð¾ÑÐ¼Ð° Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð°, Ð¶Ð´ÑÑ reCAPTCHA. Telehealth Provider Network. TRT, GLP-1, Ð¿ÐµÐ¿ÑÐ¸Ð´Ñ Ð² ÑÐµÐºÐ±Ð¾ÐºÑÐ°Ñ ÑÐ¾ÑÐ¼Ñ. ÐÐ¾ÐºÑÑÑÐ¸Ðµ ÑÑÐ°ÑÐ¾Ð² ÑÑÐ¾ÑÐ½Ð¸ÑÑ."
  },
  {
    id: 5, name: "MyTelemedicine", url: "https://mytelemedicine.com", contact: "sales@mytelemedicine.com",
    scores: {s1:4, s2:4, s3:4, s4:4, s5:3},
    status: "contacted", meetingDate: "", price: "", launch: "", decision: "pending",
    meetingLink: "",
    notes: "Email Ð¾ÑÐ¿ÑÐ°Ð²Ð»ÐµÐ½ Ð½Ð° sales@mytelemedicine.com. JD Power #1 2024. Nationwide clinician network. White-label, DTC-focused."
  },
  {
    id: 3, name: "Wheel", url: "https://wheel.com", contact: "https://info.wheel.com/l/1037703/2026-01-30/37bh9",
    scores: {s1:4, s2:5, s3:2, s4:3, s5:2},
    status: "contacted", meetingDate: "", price: "", launch: "", decision: "pending",
    meetingLink: "",
    notes: "â ï¸ MAYBE â ÑÐ¾ÑÐ¼Ð° Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð°, Ð¶Ð´ÑÑ reCAPTCHA. $216M funding. ÐÐµ ÑÑÐ½Ð¾: BYO-pharmacy (2/5), Ð½ÐµÑ ÑÐ²Ð½Ð¾Ð³Ð¾ ÑÐ¾ÐºÑÑÐ° TRT/Ð¿ÐµÐ¿ÑÐ¸Ð´Ñ (3/5), enterprise-pricing Ð½Ðµ Ð´Ð»Ñ $137/Ð¼ÐµÑ (2/5). Ð£ÑÐ¾ÑÐ½Ð¸ÑÑ Ð½Ð° Ð·Ð²Ð¾Ð½ÐºÐµ."
  },
  {
    id: 16, name: "This American Doc", url: "https://thisamericandoc.com", contact: "https://thisamericandoc.com/companies",
    scores: {s1:4, s2:4, s3:3, s4:2, s5:3},
    status: "rejected", meetingDate: "", price: "", launch: "", decision: "nogo",
    meetingLink: "",
    notes: "â ÐÐÐ£ÐÐ¡ â email info@thisamericandoc.com Ð½Ðµ ÑÑÑÐµÑÑÐ²ÑÐµÑ (550 5.1.1 address not found). Email Ð¾ÑÐ¿ÑÐ°Ð²Ð»ÐµÐ½ 26 ÑÐµÐ², Ð²ÐµÑÐ½ÑÐ»ÑÑ. Physician-owned telehealth staffing. 16/25 â Ð±ÑÐ» Ð½Ð¸Ð¶Ðµ Ð¿ÑÐ¾ÑÐ¾Ð´Ð½Ð¾Ð³Ð¾. Ð£ÐÐ ÐÐ¢Ð¬."
  }
];

var DATA = [];
var currentFilter = 'all';
var editingId = null;
var syncStatus = 'idle'; // idle, syncing, synced, error

// ========== FIRESTORE FUNCTIONS ==========
function setSyncStatus(status, msg) {
  syncStatus = status;
  var el = document.getElementById('sync-indicator');
  if (!el) return;
  var labels = {idle:'', syncing:'â³ Ð¡Ð¾ÑÑÐ°Ð½ÐµÐ½Ð¸Ðµ...', synced:'â Ð¡Ð¾ÑÑÐ°Ð½ÐµÐ½Ð¾ Ð² Ð¾Ð±Ð»Ð°ÐºÐ¾', error:'â ÐÑÐ¸Ð±ÐºÐ°: ' + (msg||'')};
  var colors = {idle:'transparent', syncing:'#fbbf24', synced:'#34d399', error:'#f87171'};
  el.textContent = labels[status] || '';
  el.style.color = colors[status] || '#94a3b8';
  if (status === 'synced') setTimeout(function(){ if (syncStatus === 'synced') { el.textContent = ''; } }, 3000);
}

async function loadFromFirestore() {
  try {
    var snapshot = await db.collection(COLLECTION).get();
    if (snapshot.empty) return [];
    var arr = [];
    snapshot.forEach(function(doc) {
      var d = doc.data();
      d._docId = doc.id;
      arr.push(d);
    });
    return arr;
  } catch(e) {
    console.error('Firestore load error:', e);
    return [];
  }
}

async function saveToFirestore(obj) {
  setSyncStatus('syncing');
  try {
    var docId = String(obj.id);
    var saveObj = Object.assign({}, obj);
    delete saveObj._docId;
    await db.collection(COLLECTION).doc(docId).set(saveObj);
    setSyncStatus('synced');
  } catch(e) {
    console.error('Firestore save error:', e);
    setSyncStatus('error', e.message);
  }
}

async function deleteFromFirestore(id) {
  setSyncStatus('syncing');
  try {
    await db.collection(COLLECTION).doc(String(id)).delete();
    setSyncStatus('synced');
  } catch(e) {
    console.error('Firestore delete error:', e);
    setSyncStatus('error', e.message);
  }
}

async function seedFirestore() {
  setSyncStatus('syncing');
  try {
    var batch = db.batch();
    SEED_DATA.forEach(function(item) {
      var docRef = db.collection(COLLECTION).doc(String(item.id));
      batch.set(docRef, item);
    });
    await batch.commit();
    setSyncStatus('synced');
    console.log('Seeded ' + SEED_DATA.length + ' companies to Firestore');
  } catch(e) {
    console.error('Firestore seed error:', e);
    setSyncStatus('error', e.message);
  }
}

async function initApp() {
  // Add sync indicator to header
  var headerActions = document.querySelector('.header-actions');
  if (headerActions) {
    var indicator = document.createElement('span');
    indicator.id = 'sync-indicator';
    indicator.style.cssText = 'font-size:12px;padding:8px 12px;color:#94a3b8;';
    headerActions.insertBefore(indicator, headerActions.firstChild);
  }

  setSyncStatus('syncing');
  var firestoreData = await loadFromFirestore();

  if (firestoreData.length > 0) {
    DATA = firestoreData;
    console.log('Loaded ' + DATA.length + ' companies from Firestore');
    setSyncStatus('synced');
  } else {
    console.log('Firestore empty â seeding with SEED_DATA...');
    DATA = SEED_DATA.slice();
    await seedFirestore();
  }
  renderAll();
}

// ========== UI FUNCTIONS ==========
function getTotal(c) { return c.scores.s1 + c.scores.s2 + c.scores.s3 + c.scores.s4 + c.scores.s5; }
function isQualified(c) { return getTotal(c) >= 18; }

function renderStats() {
  var total = DATA.length;
  var qualified = DATA.filter(isQualified).length;
  var booked = DATA.filter(c => c.status === 'booked' || c.status === 'done').length;
  var done = DATA.filter(c => c.status === 'done').length;
  var activeTasks = DATA.filter(c => c.nextTask && !c.taskDone).length;
  var overdueTasks = DATA.filter(c => { if (!c.nextTask || c.taskDone) return false; var d = parseTaskDeadline(c.taskDeadline); var now = new Date(); now.setHours(0,0,0,0); return d && d < now; }).length;
  var taskColor = overdueTasks > 0 ? 'red' : activeTasks > 0 ? 'amber' : 'green';
  var taskLabel = overdueTasks > 0 ? activeTasks + ' (â ï¸' + overdueTasks + ' Ð¿ÑÐ¾ÑÑÐ¾ÑÐµÐ½Ð¾)' : activeTasks;
  document.getElementById('stats-bar').innerHTML = `
    <div class="stat-card"><div class="label">ÐÑÐµÐ³Ð¾ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¹</div><div class="value blue">${total}</div></div>
    <div class="stat-card"><div class="label">ÐÐ²Ð°Ð»Ð¸ÑÐ¸ÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð½ÑÑ (â¥18)</div><div class="value green">${qualified}</div></div>
    <div class="stat-card"><div class="label">ÐÑÑÑÐµÑ Ð·Ð°Ð±ÑÐºÐ°Ð½Ð¾</div><div class="value amber">${booked}</div></div>
    <div class="stat-card"><div class="label">ÐÑÑÑÐµÑ Ð¿ÑÐ¾Ð²ÐµÐ´ÐµÐ½Ð¾</div><div class="value red">${done}</div></div>
    <div class="stat-card"><div class="label">ð¥ ÐÐºÑÐ¸Ð²Ð½ÑÑ Ð·Ð°Ð´Ð°Ñ</div><div class="value ${taskColor}">${taskLabel}</div></div>
  `;
}

function parseMeetingDate(str) {
  if (!str) return null;
  // Format: "Feb 27, 1:30 PM ET (Ð¿Ñ)" or "Mar 2, 3:30 PM ET (Ð¿Ð½)"
  var m = str.match(/^(\w+)\s+(\d+),?\s+(\d+):(\d+)\s+(AM|PM)/i);
  if (!m) return null;
  var months = {Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};
  var mon = months[m[1]];
  if (mon === undefined) return null;
  var day = parseInt(m[2]);
  var hour = parseInt(m[3]);
  var min = parseInt(m[4]);
  if (m[5] === 'PM' && hour < 12) hour += 12;
  if (m[5] === 'AM' && hour === 12) hour = 0;
  var year = new Date().getFullYear();
  var d = new Date(year, mon, day, hour, min);
  // If date is far in the past (>6 months), assume next year
  if (d < new Date() - 180*86400000) d.setFullYear(year + 1);
  return d;
}

function smartSort(arr) {
  var now = new Date();
  return arr.slice().sort(function(a, b) {
    var dA = parseMeetingDate(a.meetingDate);
    var dB = parseMeetingDate(b.meetingDate);
    var hasA = dA !== null;
    var hasB = dB !== null;
    // Companies with meetings first, no meetings last
    if (hasA && !hasB) return -1;
    if (!hasA && hasB) return 1;
    if (!hasA && !hasB) {
      // Both no meetings: NO-GO at bottom, then by total score desc
      if (a.decision === 'nogo' && b.decision !== 'nogo') return 1;
      if (a.decision !== 'nogo' && b.decision === 'nogo') return -1;
      return getTotal(b) - getTotal(a);
    }
    // Both have meetings
    var futA = dA >= now;
    var futB = dB >= now;
    // Future meetings first (closest on top)
    if (futA && futB) return dA - dB;
    if (futA && !futB) return -1;
    if (!futA && futB) return 1;
    // Both past: most recent first
    return dB - dA;
  });
}

function parseTaskDeadline(str) {
  if (!str) return null;
  // Supports: "2025-03-05", "Mar 5", "Mar 5, 2025"
  var d = new Date(str);
  if (!isNaN(d)) return d;
  var m = str.match(/^(\w+)\s+(\d+)/);
  if (m) {
    var months = {Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};
    var mon = months[m[1]];
    if (mon !== undefined) {
      d = new Date(new Date().getFullYear(), mon, parseInt(m[2]));
      if (d < new Date() - 180*86400000) d.setFullYear(d.getFullYear()+1);
      return d;
    }
  }
  return null;
}

function renderTaskCell(c) {
  if (!c.nextTask) return '<span class="task-none">â</span>';
  var taskDone = c.taskDone === true;
  var deadline = parseTaskDeadline(c.taskDeadline);
  var now = new Date();
  now.setHours(0,0,0,0);
  var isOverdue = deadline && !taskDone && deadline < now;
  var diffDays = deadline ? Math.ceil((deadline - now) / 86400000) : null;
  var badgeClass = taskDone ? 'task-done' : isOverdue ? 'task-overdue' : 'task-active';
  var deadlineClass = 'normal';
  var deadlineLabel = '';
  if (deadline) {
    if (taskDone) { deadlineClass = 'normal'; deadlineLabel = c.taskDeadline; }
    else if (isOverdue) { deadlineClass = 'urgent'; deadlineLabel = 'â ï¸ ÐÑÐ¾ÑÑÐ¾ÑÐµÐ½Ð¾! ' + c.taskDeadline; }
    else if (diffDays === 0) { deadlineClass = 'urgent'; deadlineLabel = 'ð´ Ð¡ÐµÐ³Ð¾Ð´Ð½Ñ!'; }
    else if (diffDays === 1) { deadlineClass = 'soon'; deadlineLabel = 'ð¡ ÐÐ°Ð²ÑÑÐ°'; }
    else if (diffDays <= 3) { deadlineClass = 'soon'; deadlineLabel = 'ð ' + c.taskDeadline; }
    else { deadlineClass = 'normal'; deadlineLabel = 'ð ' + c.taskDeadline; }
  }
  var checkbox = taskDone
    ? '<span onclick="toggleTask('+c.id+')" style="cursor:pointer;font-size:14px" title="ÐÑÐ¼ÐµÐ½Ð¸ÑÑ Ð²ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ">âï¸</span>'
    : '<span onclick="toggleTask('+c.id+')" style="cursor:pointer;font-size:14px" title="ÐÑÐ¼ÐµÑÐ¸ÑÑ Ð²ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð½Ð¾Ð¹">â¬</span>';
  return '<div class="task-badge '+badgeClass+'" style="cursor:pointer" onclick="editRow('+c.id+')">'
    + checkbox
    + '<div>'
    + '<span class="task-text" title="'+c.nextTask.replace(/"/g,'&quot;')+'">'+c.nextTask+'</span>'
    + (deadlineLabel ? '<div class="task-deadline '+deadlineClass+'">'+deadlineLabel+'</div>' : '')
    + (c.taskResponsible ? '<div class="task-responsible">ð¤ '+c.taskResponsible+'</div>' : '')
    + '</div></div>';
}

async function toggleTask(id) {
  event.stopPropagation();
  var c = DATA.find(x => x.id === id);
  if (!c) return;
  c.taskDone = !c.taskDone;
  renderAll();
  await saveToFirestore(c);
}

function renderContactsPanel(c) {
  var html = '';
  if (c.contactName || c.contactEmail || c.contactPhone) {
    html += '<div style="margin-bottom:6px"><strong>ð¤ ' + (c.contactName||'â') + '</strong>';
    if (c.contactRole) html += ' <span style="color:#64748b;font-size:10px">(' + c.contactRole + ')</span>';
    html += '</div>';
    if (c.contactEmail) html += '<div style="font-size:11px">ð§ <a href="mailto:'+c.contactEmail+'" style="color:#38bdf8">'+c.contactEmail+'</a></div>';
    if (c.contactPhone) html += '<div style="font-size:11px">ð± '+c.contactPhone+'</div>';
  }
  if (c.pros && c.pros.length) {
    html += '<h4 style="color:#34d399;margin-top:8px">ðª Ð¡Ð¸Ð»ÑÐ½ÑÐµ ÑÑÐ¾ÑÐ¾Ð½Ñ</h4><ul style="margin:4px 0 4px 16px">';
    c.pros.forEach(function(p){ html += '<li style="color:#34d399;font-size:11px">'+p+'</li>'; });
    html += '</ul>';
  }
  if (c.cons && c.cons.length) {
    html += '<h4 style="color:#f87171;margin-top:8px">â ï¸ Ð¡Ð»Ð°Ð±ÑÐµ ÑÑÐ¾ÑÐ¾Ð½Ñ</h4><ul style="margin:4px 0 4px 16px">';
    c.cons.forEach(function(p){ html += '<li style="color:#f87171;font-size:11px">'+p+'</li>'; });
    html += '</ul>';
  }
  if (c.checklist && c.checklist.length) {
    html += '<h4 style="color:#fbbf24;margin-top:8px">â Ð§ÐµÐºÐ»Ð¸ÑÑ</h4>';
    c.checklist.forEach(function(q, qi){
      html += '<div style="font-size:11px;margin:2px 0;cursor:pointer" onclick="toggleChecklist('+c.id+','+qi+')">';
      html += q.done ? 'âï¸ <span style="text-decoration:line-through;color:#64748b">'+q.text+'</span>' : 'â¬ '+q.text;
      html += '</div>';
    });
  }
  return html;
}

async function toggleChecklist(companyId, qIdx) {
  event.stopPropagation();
  var c = DATA.find(x => x.id === companyId);
  if (!c || !c.checklist || !c.checklist[qIdx]) return;
  c.checklist[qIdx].done = !c.checklist[qIdx].done;
  renderAll();
  await saveToFirestore(c);
}

function toggleContacts(id) {
  var panel = document.getElementById('contacts-' + id);
  if (panel) panel.classList.toggle('show');
}

function toggleMeetingsLog(id) {
  var panel = document.getElementById('meetingslog-' + id);
  if (panel) panel.classList.toggle('show');
}

function renderMeetingsLogInline(c) {
  var logs = c.meetingsLog || [];
  if (!logs.length) return '';
  var typeLabels = {first:'ÐÐµÑÐ²Ð¸ÑÐ½Ð°Ñ',followup:'Follow-up',demo:'ÐÐµÐ¼Ð¾',call:'ÐÐ²Ð¾Ð½Ð¾Ðº',email:'Email'};
  var html = '<h4 style="color:#38bdf8;margin-bottom:6px">ð ÐÑÑÐ¾ÑÐ¸Ñ Ð²ÑÑÑÐµÑ</h4>';
  logs.forEach(function(log) {
    html += '<div style="border-left:2px solid #334155;padding-left:8px;margin-bottom:8px">'
      + '<div style="font-size:11px"><strong style="color:#38bdf8">' + log.date + '</strong> '
      + '<span style="color:#64748b;font-size:10px">(' + (typeLabels[log.type]||log.type) + ')</span></div>'
      + '<div style="font-size:11px;color:#cbd5e1;margin-top:2px;white-space:pre-wrap">' + log.summary + '</div>'
      + '</div>';
  });
  return html;
}

function renderTable() {
  var filtered = DATA;
  if (currentFilter === 'qualified') filtered = DATA.filter(isQualified);
  else if (currentFilter === 'booked') filtered = DATA.filter(c => c.status === 'booked');
  else if (currentFilter === 'done') filtered = DATA.filter(c => c.status === 'done');
  else if (currentFilter === 'tasks') filtered = DATA.filter(c => c.nextTask && !c.taskDone);

  filtered = smartSort(filtered);

  var html = '';
  filtered.forEach(function(c, i) {
    var t = getTotal(c);
    var tClass = t >= 20 ? 'total-high' : t >= 18 ? 'total-mid' : 'total-low';
    var topBadge = t >= 20 ? '<span style="background:#059669;color:#fff;padding:2px 6px;border-radius:4px;font-size:9px;font-weight:700;margin-left:6px;vertical-align:middle">TOP</span>' : '';
    var rowBorder = t >= 20 ? 'border-left:3px solid #34d399;' : t < 18 ? 'border-left:3px solid #f87171;' : '';
    // Highlight upcoming meetings
    var meetDate = parseMeetingDate(c.meetingDate);
    var now = new Date();
    var urgentStyle = '';
    var meetBadge = '';
    if (meetDate) {
      var diffH = (meetDate - now) / 3600000;
      if (diffH > 0 && diffH <= 24) { urgentStyle = 'background:rgba(251,191,36,0.08);'; meetBadge = '<span style="background:#f59e0b;color:#000;padding:1px 6px;border-radius:4px;font-size:9px;font-weight:700;margin-left:6px;vertical-align:middle">Ð¡ÐÐÐÐÐÐ¯</span>'; }
      else if (diffH > 24 && diffH <= 48) { urgentStyle = 'background:rgba(56,189,248,0.06);'; meetBadge = '<span style="background:#0ea5e9;color:#fff;padding:1px 6px;border-radius:4px;font-size:9px;font-weight:700;margin-left:6px;vertical-align:middle">ÐÐÐÐ¢Ð Ð</span>'; }
      else if (diffH > 0 && diffH <= 168) { meetBadge = '<span style="background:#6366f1;color:#fff;padding:1px 6px;border-radius:4px;font-size:9px;font-weight:700;margin-left:6px;vertical-align:middle">Ð¡ÐÐÐ Ð</span>'; }
    }
    var statusLabels = {none:'ÐÐµ Ð½Ð°ÑÐ°Ñ',contacted:'Ð¤Ð¾ÑÐ¼Ð°/Email',booked:'ÐÐ°Ð±ÑÐºÐ°Ð½Ð°',done:'â ÐÑÐ¾Ð²ÐµÐ´ÐµÐ½Ð°',rejected:'ÐÐµ Ð¿Ð¾Ð´ÑÐ¾Ð´Ð¸Ñ'};
    var decLabels = {pending:'â³', go:'â GO', nogo:'â NO-GO'};
    var decClass = {pending:'decision-pending', go:'decision-go', nogo:'decision-nogo'};
    html += `<tr data-id="${c.id}" style="${rowBorder}${urgentStyle}">
      <td style="color:#475569">${i+1}</td>
      <td><div class="company-name">${c.name}${topBadge}</div><div class="company-url"><a href="${c.url}" target="_blank">${c.url.replace('https://','')}</a></div>${c.emailThreads && c.emailThreads.length > 0 ? '<div class="email-link"><a href="' + c.emailThreads[0].url + '" target="_blank">\u2709\uFE0F ' + c.emailThreads[0].label + '</a></div>' : ''}</td>
      <td class="score-cell"><span class="score-badge score-${c.scores.s1}">${c.scores.s1}</span></td>
      <td class="score-cell"><span class="score-badge score-${c.scores.s2}">${c.scores.s2}</span></td>
      <td class="score-cell"><span class="score-badge score-${c.scores.s3}">${c.scores.s3}</span></td>
      <td class="score-cell"><span class="score-badge score-${c.scores.s4}">${c.scores.s4}</span></td>
      <td class="score-cell"><span class="score-badge score-${c.scores.s5}">${c.scores.s5}</span></td>
      <td class="total-score ${tClass}">${t}/25</td>
      <td><span class="status-badge status-${c.status}">${statusLabels[c.status]||c.status}</span></td>
      <td style="font-size:12px;white-space:nowrap">${c.meetingDate ? c.meetingDate + meetBadge + (c.status === 'done' || c.status === 'rejected' ? '' : (c.meetingLink ? '<br><a href="'+c.meetingLink+'" target="_blank" style="color:#38bdf8;font-size:11px;font-weight:600;">ð ÐÐ¾Ð´ÐºÐ»ÑÑÐ¸ÑÑÑÑ</a>' : '<br><span style="color:#475569;font-size:10px;cursor:pointer" onclick="editRow('+c.id+')">+ Ð´Ð¾Ð±Ð°Ð²Ð¸ÑÑ ÑÑÑÐ»ÐºÑ</span>')) : 'â'}</td>
      <td style="font-size:12px">${c.price||'â'}</td>
      <td style="font-size:12px">${c.launch||'â'}</td>
      <td><span class="${decClass[c.decision]}">${decLabels[c.decision]}</span></td>
      <td>${renderTaskCell(c)}</td>
      <td class="notes-cell">
        <span class="editable" title="${(c.notes||'').replace(/"/g,'&quot;')}" onclick="editRow(${c.id})">${c.notes ? c.notes.substring(0,50)+'...' : 'ÐÐ°Ð¶Ð¼Ð¸ Ð´Ð»Ñ ÑÐµÐ´.'}</span>
        ${c.meetingSummary ? '<span class="summary-toggle" onclick="toggleSummary('+c.id+')">ð ÐÑÐ¾Ð³Ð¸ Ð²ÑÑÑÐµÑÐ¸</span><div class="summary-panel" id="summary-'+c.id+'"><h4>ÐÐµÑÐ´Ð¸ÐºÑ</h4><div class="verdict verdict-'+c.meetingSummary.verdict+'">'+c.meetingSummary.verdictText+'</div><h4>Ð¦ÐµÐ½Ñ</h4>'+c.meetingSummary.pricing+'<h4>ÐÐ¾Ð½ÑÐ°ÐºÑÑ</h4>'+c.meetingSummary.keyContacts+'<h4>ÐÐ°ÑÑÐ½ÑÑÑ</h4>'+c.meetingSummary.partners+'<h4>Ð¡Ð»ÐµÐ´ÑÑÑÐ¸Ðµ ÑÐ°Ð³Ð¸</h4>'+c.meetingSummary.nextSteps+'</div>' : ''}
        ${(c.contactName || (c.pros && c.pros.length) || (c.checklist && c.checklist.length)) ? '<span class="summary-toggle" onclick="toggleContacts('+c.id+')">ð¥ ÐÐ¾Ð½ÑÐ°ÐºÑÑ/ÐÐ½ÑÐ¾</span><div class="summary-panel" id="contacts-'+c.id+'">'+renderContactsPanel(c)+'</div>' : ''}
        ${(c.meetingsLog && c.meetingsLog.length) ? '<span class="summary-toggle" onclick="toggleMeetingsLog('+c.id+')">ð ÐÑÑÑÐµÑÐ¸ ('+c.meetingsLog.length+')</span><div class="summary-panel" id="meetingslog-'+c.id+'">'+renderMeetingsLogInline(c)+'</div>' : ''}
      </td>
      <td><div class="row-actions">
        <button class="row-btn" onclick="editRow(${c.id})" title="Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ">âï¸</button>
        <button class="row-btn" onclick="deleteRow(${c.id})" title="Ð£Ð´Ð°Ð»Ð¸ÑÑ">ðï¸</button>
      </div></td>
    </tr>`;
  });
  document.getElementById('table-body').innerHTML = html;
}

function setFilter(f) {
  currentFilter = f;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
  renderTable();
}

function editRow(id) {
  editingId = id;
  var c = DATA.find(x => x.id === id);
  if (!c) return;
  document.getElementById('modal-title').textContent = 'Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ: ' + c.name;
  document.getElementById('m-name').value = c.name;
  document.getElementById('m-url').value = c.url;
  document.getElementById('m-contact').value = c.contact || '';
  document.getElementById('m-s1').value = c.scores.s1;
  document.getElementById('m-s2').value = c.scores.s2;
  document.getElementById('m-s3').value = c.scores.s3;
  document.getElementById('m-s4').value = c.scores.s4;
  document.getElementById('m-s5').value = c.scores.s5;
  document.getElementById('m-status').value = c.status;
  document.getElementById('m-meeting-date').value = c.meetingDate || '';
  document.getElementById('m-meeting-link').value = c.meetingLink || '';
  document.getElementById('m-price').value = c.price || '';
  document.getElementById('m-launch').value = c.launch || '';
  document.getElementById('m-decision').value = c.decision || 'pending';
  document.getElementById('m-notes').value = c.notes || '';
  document.getElementById('m-next-task').value = c.nextTask || '';
  document.getElementById('m-task-deadline').value = c.taskDeadline || '';
  document.getElementById('m-task-responsible').value = c.taskResponsible || '';
  document.getElementById('m-task-done').checked = c.taskDone || false;
  document.getElementById('m-contact-name').value = c.contactName || '';
  document.getElementById('m-contact-email').value = c.contactEmail || '';
  document.getElementById('m-contact-phone').value = c.contactPhone || '';
  document.getElementById('m-contact-role').value = c.contactRole || '';
  document.getElementById('m-pros').value = (c.pros || []).join('; ');
  document.getElementById('m-pros-cons').value = (c.cons || []).join('; ');
  document.getElementById('m-checklist').value = (c.checklist || []).map(q => (q.done ? '[x] ' : '') + q.text).join('; ');
  renderMeetingsLog();
  document.getElementById('edit-modal').classList.add('show');
}

function addCompany() {
  editingId = null;
  document.getElementById('modal-title').textContent = 'ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ñ';
  ['m-name','m-url','m-contact','m-meeting-date','m-meeting-link','m-price','m-launch','m-notes','m-next-task','m-task-deadline','m-task-responsible','m-contact-name','m-contact-email','m-contact-phone','m-contact-role','m-pros','m-pros-cons','m-checklist'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('m-task-done').checked = false;
  ['m-s1','m-s2','m-s3','m-s4','m-s5'].forEach(id => document.getElementById(id).value = '3');
  document.getElementById('m-status').value = 'none';
  document.getElementById('m-decision').value = 'pending';
  document.getElementById('m-meetings-log').innerHTML = '<div style="color:#475569;font-size:12px;text-align:center;padding:10px">ÐÐ¾ÐºÐ° Ð½ÐµÑ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð¾ Ð²ÑÑÑÐµÑÐ°Ñ</div>';
  document.getElementById('edit-modal').classList.add('show');
}

function closeModal() { document.getElementById('edit-modal').classList.remove('show'); }

async function saveModal() {
  var obj = {
    name: document.getElementById('m-name').value,
    url: document.getElementById('m-url').value,
    contact: document.getElementById('m-contact').value,
    scores: {
      s1: parseInt(document.getElementById('m-s1').value),
      s2: parseInt(document.getElementById('m-s2').value),
      s3: parseInt(document.getElementById('m-s3').value),
      s4: parseInt(document.getElementById('m-s4').value),
      s5: parseInt(document.getElementById('m-s5').value)
    },
    status: document.getElementById('m-status').value,
    meetingDate: document.getElementById('m-meeting-date').value,
    meetingLink: document.getElementById('m-meeting-link').value,
    price: document.getElementById('m-price').value,
    launch: document.getElementById('m-launch').value,
    decision: document.getElementById('m-decision').value,
    notes: document.getElementById('m-notes').value,
    nextTask: document.getElementById('m-next-task').value,
    taskDeadline: document.getElementById('m-task-deadline').value,
    taskResponsible: document.getElementById('m-task-responsible').value,
    taskDone: document.getElementById('m-task-done').checked,
    contactName: document.getElementById('m-contact-name').value,
    contactEmail: document.getElementById('m-contact-email').value,
    contactPhone: document.getElementById('m-contact-phone').value,
    contactRole: document.getElementById('m-contact-role').value,
    pros: document.getElementById('m-pros').value.split(';').map(s=>s.trim()).filter(Boolean),
    cons: document.getElementById('m-pros-cons').value.split(';').map(s=>s.trim()).filter(Boolean),
    checklist: document.getElementById('m-checklist').value.split(';').map(s => { s = s.trim(); var done = s.startsWith('[x]'); return {text: s.replace(/^\[x\]\s*/, ''), done: done}; }).filter(q => q.text)
  };
  if (editingId) {
    var idx = DATA.findIndex(x => x.id === editingId);
    if (idx >= 0) {
      // Preserve meetingSummary and meetingsLog
      if (DATA[idx].meetingSummary) obj.meetingSummary = DATA[idx].meetingSummary;
      if (DATA[idx].meetingsLog) obj.meetingsLog = DATA[idx].meetingsLog;
      // Preserve taskDone toggle state if task text unchanged
      if (!obj.nextTask && DATA[idx].nextTask) { obj.nextTask = DATA[idx].nextTask; obj.taskDeadline = DATA[idx].taskDeadline; obj.taskResponsible = DATA[idx].taskResponsible; obj.taskDone = DATA[idx].taskDone; }
      obj.id = editingId;
      DATA[idx] = obj;
    }
  } else {
    obj.id = Math.max(0, ...DATA.map(x => x.id)) + 1;
    DATA.push(obj);
  }
  closeModal();
  renderAll();
  // Sync to Firestore
  await saveToFirestore(obj);
}

async function deleteRow(id) {
  if (!confirm('Ð£Ð´Ð°Ð»Ð¸ÑÑ ÑÑÑ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ñ?')) return;
  DATA = DATA.filter(x => x.id !== id);
  renderAll();
  // Sync delete to Firestore
  await deleteFromFirestore(id);
}

function toggleSummary(id) {
  var panel = document.getElementById('summary-' + id);
  if (panel) panel.classList.toggle('show');
}

// ========== MEETING LOG ==========
function renderMeetingsLog() {
  var c = DATA.find(x => x.id === editingId);
  var logs = (c && c.meetingsLog) || [];
  var html = '';
  if (logs.length === 0) {
    html = '<div style="color:#475569;font-size:12px;text-align:center;padding:10px">ÐÐ¾ÐºÐ° Ð½ÐµÑ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð¾ Ð²ÑÑÑÐµÑÐ°Ñ</div>';
  } else {
    var typeLabels = {first:'ÐÐµÑÐ²Ð¸ÑÐ½Ð°Ñ',followup:'Follow-up',demo:'ÐÐµÐ¼Ð¾',call:'ÐÐ²Ð¾Ð½Ð¾Ðº',email:'Email'};
    logs.forEach(function(log, i) {
      var typeClass = log.type === 'first' ? 'log-type-first' : log.type === 'followup' ? 'log-type-followup' : log.type === 'demo' ? 'log-type-demo' : '';
      html += '<div class="meeting-log-entry">'
        + '<div><span class="log-date">ð ' + log.date + '</span>'
        + '<span class="log-type ' + typeClass + '">' + (typeLabels[log.type] || log.type) + '</span></div>'
        + '<div class="log-summary">' + log.summary + '</div>'
        + '<button class="log-delete" onclick="deleteMeetingLog(' + i + ')" title="Ð£Ð´Ð°Ð»Ð¸ÑÑ">â</button>'
        + '</div>';
    });
  }
  document.getElementById('m-meetings-log').innerHTML = html;
}

function addMeetingLog() {
  var date = document.getElementById('m-meeting-log-date').value.trim();
  var type = document.getElementById('m-meeting-log-type').value;
  var summary = document.getElementById('m-meeting-log-summary').value.trim();
  if (!date || !summary) { alert('Ð£ÐºÐ°Ð¶Ð¸ÑÐµ Ð´Ð°ÑÑ Ð¸ ÐºÑÐ°ÑÐºÐ¾Ðµ ÑÐ¾Ð´ÐµÑÐ¶Ð°Ð½Ð¸Ðµ Ð²ÑÑÑÐµÑÐ¸'); return; }
  var c = DATA.find(x => x.id === editingId);
  if (!c) return;
  if (!c.meetingsLog) c.meetingsLog = [];
  c.meetingsLog.unshift({ date: date, type: type, summary: summary, addedAt: new Date().toISOString() });
  document.getElementById('m-meeting-log-date').value = '';
  document.getElementById('m-meeting-log-summary').value = '';
  renderMeetingsLog();
}

async function deleteMeetingLog(idx) {
  if (!confirm('Ð£Ð´Ð°Ð»Ð¸ÑÑ ÑÑÑ Ð·Ð°Ð¿Ð¸ÑÑ?')) return;
  var c = DATA.find(x => x.id === editingId);
  if (c && c.meetingsLog) {
    c.meetingsLog.splice(idx, 1);
    renderMeetingsLog();
  }
}

function renderAll() { renderStats(); renderTable(); }

function saveFile() {
  var html = document.documentElement.outerHTML;
  var dataStr = 'var SEED_DATA = ' + JSON.stringify(DATA, null, 2) + ';';
  html = html.replace(/var SEED_DATA = \[[\s\S]*?\];/, dataStr);
  var blob = new Blob(['<!DOCTYPE html>\n<html lang="ru">\n' + html.split('<html lang="ru">')[1]], {type: 'text/html'});
  var a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'AVG_Telehealth_Tracker.html';
  a.click();
  URL.revokeObjectURL(a.href);
  alert('Ð¤Ð°Ð¹Ð» ÑÐ¾ÑÑÐ°Ð½ÑÐ½ ÐºÐ°Ðº Ð±ÑÐºÐ°Ð¿! ÐÑÐ½Ð¾Ð²Ð½ÑÐµ Ð´Ð°Ð½Ð½ÑÐµ ÑÑÐ°Ð½ÑÑÑÑ Ð² Firebase.');
}

// Close modal on outside click
document.getElementById('edit-modal').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});

// ========== START APP ==========
initApp();
</script>
</body>
</html>
